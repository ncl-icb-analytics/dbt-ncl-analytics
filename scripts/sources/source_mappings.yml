# Source Database and Schema Mappings for NCL Analytics
# This file defines how source databases/schemas map to dbt sources
# Supports both OLIDS and Commissioning data sources
#
# Structure:
#   - source_name: Name used in dbt source() references
#     database: Source database name
#     schema: Source schema name (optional - if omitted, all schemas in database)
#     description: What this data source contains
#     raw_prefix: Prefix for raw layer models (optional, defaults to raw_{source_name})
#     domain: Which domain folder to create raw models in (commissioning, olids, shared)

version: 1

sources:
  # ========================================
  # COMMISSIONING DATA SOURCES [DSCRO, national]
  # ========================================
  
  # Personal Demographics Service
  - source_name: pds
    database: DATA_LAKE
    schema: PDS
    description: Personal Demographics Service data
    staging_prefix: stg_pds
    domain: shared
  
  # Community services dataset
  - source_name: csds
    database: DATA_LAKE
    schema: CSDS
    description: Community services dataset
    raw_prefix: raw_csds
    domain: commissioning
  
  # Waiting Lists Data
  - source_name: wl
    database: DATA_LAKE
    schema: WL
    description: Waiting lists and patient pathway data
    raw_prefix: raw_wl
    domain: commissioning
    
  # SUS Unified - Outpatient
  - source_name: sus_op
    database: DATA_LAKE
    schema: SUS_UNIFIED_OP
    description: SUS outpatient appointments and activity
    raw_prefix: raw_sus_op
    domain: commissioning
    
  # SUS Unified - Admitted Patient Care
  - source_name: sus_apc
    database: DATA_LAKE
    schema: SUS_UNIFIED_APC
    description: SUS admitted patient care episodes and procedures
    raw_prefix: raw_sus_apc
    domain: commissioning
  
   # SUS Unified - Emergency Care
  - source_name: sus_ae
    database: DATA_LAKE
    schema: SUS_UNIFIED_ECDS
    description: SUS emergency care attendances and activity
    raw_prefix: raw_sus_ae
    domain: commissioning

  # eRS referrals
  - source_name: eRS_primary_care
    database: DATA_LAKE
    schema: ERS
    description: Primary care referrals data
    raw_prefix: raw_ers_pc
    domain: commissioning

  # EPD Primary Care
  - source_name: epd_primary_care
    database: DATA_LAKE
    schema: EPD_PRIMARY_CARE
    description: Primary care medications and prescribing data
    raw_prefix: raw_epd_pc
    domain: commissioning

  # Mental Health Services Data Set (MHSDS)
  - source_name: mhsds
    database: DATA_LAKE
    schema: MHSDS
    description: Mental Health Services Data Set (MHSDS)
    raw_prefix: raw_mhsds
    domain: commissioning

  # Registry Data (Births/Deaths)
  - source_name: registries_deaths
    database: DATA_LAKE
    schema: DEATHS
    description: Register of deaths
    raw_prefix: raw_registries_deaths
    domain: shared

  - source_name: registries_births
    database: DATA_LAKE
    schema: BIRTHS
    description: Register of births
    raw_prefix: raw_registries_births
    domain: shared

    # Adult social care (CLD)
  - source_name: adult_social_care_cld
    database: DATA_LAKE
    schema: SOCIAL_CARE
    description: National submission from local authorities for adult social care (client level dataset)
    raw_prefix: raw_asc_cld
    domain: shared


  # ========================================
  # COMMISSIONING DICTIONARIES [DSCRO, national]
  # ========================================
    
  # Dictionary/Reference Data dbo
  - source_name: dictionary_dbo
    database: Dictionary
    schema: dbo
    description: Reference data including PDS and lookup tables
    raw_prefix: raw_dictionary_dbo
    domain: shared

  # Dictionary/Reference Data ECDS_ETOS
  - source_name: dictionary_ecds
    database: Dictionary
    schema: ECDS_ETOS
    description: Reference data for ECDS
    raw_prefix: raw_dictionary_ecds
    domain: shared

  # Dictionary/Reference Data OP
  - source_name: dictionary_op
    database: Dictionary
    schema: OP
    description: Reference data for outpatient procedures and treatments
    raw_prefix: raw_dictionary_op
    domain: shared

    # Dictionary/Reference Data IP
  - source_name: dictionary_ip
    database: Dictionary
    schema: IP
    description: Reference data for inpatient procedures and treatments
    raw_prefix: raw_dictionary_ip
    domain: shared

    # eRS dictionary
  - source_name: dictionary_eRS
    database: Dictionary
    schema: E-Referral
    description: Primary care referrals lookups
    raw_prefix: raw_dictionary_ers
    domain: shared


  # ========================================
  # OLIDS DATA SOURCES
  # ========================================

  # OLIDS Core Tables
  - source_name: olids
    database: DATA_LAKE
    schema: OLIDS
    description: OLIDS stable layer - cleaned and filtered patient records
    raw_prefix: raw_olids
    domain: olids

  # Dictionary/Reference Data SNOMED
  - source_name: dictionary_snomed
    database: Dictionary
    schema: Snomed
    description: Reference data for snomed
    raw_prefix: raw_dictionary_snomed
    domain: shared

  # ========================================
  # DATA_LAKE__NCL [NCL locally managed data sources]
  # ========================================

  # TERMINOLOGY schema in DATA_LAKE__NCL
  - source_name: reference_terminology
    database: DATA_LAKE__NCL
    schema: TERMINOLOGY
    description: Reference terminology data including SNOMED, BNF, and other code sets
    raw_prefix: raw_reference
    domain: shared

  # ANALYST_MANAGED schema in DATA_LAKE__NCL
  - source_name: reference_analyst_managed
    database: DATA_LAKE__NCL
    schema: ANALYST_MANAGED
    description: Analyst-managed reference datasets and business rules
    raw_prefix: raw_reference
    domain: shared

  # DATA_MANAGEMENT schema in DATA_LAKE__NCL
  - source_name: reference_data_management
    database: DATA_LAKE__NCL
    schema: DATA_MANAGEMENT
    description: Data management reference datasets
    raw_prefix: raw_reference
    domain: shared

  # CANCER schemas in DATA_LAKE__NCL
  - source_name: reference_cancer_cwt_alliance
    database: DATA_LAKE__NCL
    schema: CANCER__CWT_ALLIANCE
    description: Cancer waiting times alliance data
    raw_prefix: raw_reference
    domain: shared

  - source_name: reference_cancer_emis
    database: DATA_LAKE__NCL
    schema: CANCER__EMIS
    description: Cancer EMIS data
    raw_prefix: raw_reference
    domain: shared

  - source_name: reference_cancer_screening
    database: DATA_LAKE__NCL
    schema: CANCER__SCREENING
    description: Cancer screening data
    raw_prefix: raw_reference
    domain: shared

  # Fingertips schema in DATA_LAKE__NCL
  - source_name: reference_fingertips
    database: DATA_LAKE__NCL
    schema: FINGERTIPS
    description: Fingertips indicator data
    raw_prefix: raw_reference
    domain: shared

  # Phenolab schema in DATA_LAKE__NCL
  - source_name: phenolab
    database: DATA_LAKE__NCL
    schema: PHENOLAB_DEV
    description: Phenolab supporting data
    raw_prefix: raw_phenolab
    domain: shared

  # ========================================
  # ADDITIONAL OLIDS DATA SOURCES
  # ========================================
  # Additional OLIDS sources can be added here if needed

  # ========================================
  # MESH IN-FLOW Via PID Environment
  # ========================================

  # Local Providers Flows
  - source_name: local_provider_flows
    database: DATA_LAKE
    schema: LOCAL_PROVIDER_FLOWS
    description: Providers submissions from PID environment via MESH
    raw_prefix: raw_lpf
    domain: pid_env

  # ========================================
  # FACT SCHEMAS IN DATA_LAKE
  # ========================================

  # Fact Patient Schema
  - source_name: fact_patient
    database: DATA_LAKE
    schema: FACT_PATIENT
    description: Patient fact tables
    raw_prefix: raw_fact_patient
    domain: shared

  # Fact Practice Schema
  - source_name: fact_practice
    database: DATA_LAKE
    schema: FACT_PRACTICE
    description: Practice fact tables
    raw_prefix: raw_fact_practice
    domain: shared

  # ========================================
  # MANUAL SOURCES (not auto-generated)
  # ========================================
  # These sources are manually defined in models/sources/sources.yml
  # They are included here for raw model generation configuration only

  # Reference Lookup NCL - Analyst-managed reference datasets
  - source_name: reference_lookup_ncl
    database: MODELLING
    schema: LOOKUP_NCL
    description: Analyst-managed reference datasets and business rules in the MODELLING environment
    raw_prefix: raw_reference_lookup_ncl
    domain: shared

  # C-LTCS tables
  - source_name: c_ltcs
    database: DEV__PUBLISHED_REPORTING__DIRECT_CARE
    schema: C_LTCS
    description: C-LTCS tables
    raw_prefix: raw_c_ltcs
    domain: commissioning

  # Central Performance Analytics Team (CPAT PMCT)
  - source_name: pmct
    database: DATA_LAKE
    schema: PMCT
    description: Central Performance Analytics Team (PMCT)
    raw_prefix: raw_pmct
    domain: commissioning
