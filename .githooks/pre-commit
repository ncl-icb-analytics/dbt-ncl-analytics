#!/bin/sh
# Pre-commit hook to prevent accidental commits of profiles.yml with credentials

# Check if profiles.yml is being committed
if git diff --cached --name-only | grep -q "^profiles\.yml$"; then
    echo "⚠️  WARNING: You're about to commit profiles.yml"
    echo ""
    echo "This file should only be updated for Snowflake native execution changes,"
    echo "not for local development credentials."
    echo ""
    echo "If you really need to commit changes to profiles.yml:"
    echo "  1. Ensure it contains NO credentials (empty strings for account/user)"
    echo "  2. Type 'yes' to continue, or anything else to abort"
    echo ""
    printf "Do you want to proceed? (yes/no): "
    
    # Read user input
    read response < /dev/tty
    
    if [ "$response" != "yes" ]; then
        echo "Commit aborted. Your changes are still staged."
        echo ""
        echo "To unstage profiles.yml: git reset HEAD profiles.yml"
        echo "To ignore local changes: git update-index --skip-worktree profiles.yml"
        exit 1
    fi
    
    echo "Proceeding with commit. Please ensure no credentials are included!"
fi