version: 2

macros:
  - name: extract_indicator_metadata
    description: >
      Extracts indicator metadata from model configs across the dbt graph.
      Returns dict with 'indicators', 'codes', 'usage', and 'thresholds' lists.
      Supports both model-level (meta.indicator) and column-level metadata.


      Usage:

      ```sql

      -- In a model that builds indicator definitions:
      {% set metadata = extract_indicator_metadata() %}

      SELECT * FROM (
          {% for ind in metadata.indicators %}
          SELECT
              '{{ ind.indicator_id }}' as indicator_id,
              '{{ ind.name_short }}' as name_short
          {% if not loop.last %}UNION ALL{% endif %}
          {% endfor %}
      )

      ```
