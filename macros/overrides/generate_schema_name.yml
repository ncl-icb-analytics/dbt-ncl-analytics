version: 2

macros:
  - name: generate_schema_name
    description: >
      dbt override for schema name generation with automatic derivation from folder structure.
      For domains in var('auto_schema_domains'), derives DOMAIN_SUBDOMAIN from path.


      Usage:

      ```yaml

      # In dbt_project.yml:
      vars:
        auto_schema_domains: ['olids']

      # Then folder structure determines schema:
      # models/modelling/olids/diagnoses/ → OLIDS_DIAGNOSES
      # models/reporting/olids/person_analytics/ → OLIDS_PERSON_ANALYTICS
      # models/published/direct_care/olids/childhood_imms/ → OLIDS_CHILDHOOD_IMMS

      ```


      Behavior:

      - Domains in auto_schema_domains: Schema derived from {DOMAIN}_{SUBDOMAIN}

      - Other domains: Uses explicit schema from config or target.schema default
    arguments:
      - name: custom_schema_name
        type: string
        description: Custom schema name from config

      - name: node
        type: object
        description: dbt node object (provided by dbt)
