version: 2

models:
  - name: fct_person_myria_control_group_published
    description: >
      Patient-level dataset identifying individuals with at least one high-risk condition
      (e.g., heart failure, COPD, dementia, renal failure, etc.) or multimorbidity
      flags.
      Includes count of non-elective admissions. (Time periods for NEL
      counts, flags and inclusion criteria are based on discharge date).
      Restricted to NCL-registered patients alive at time of running, >=18 years of age at last admission and
      at least one NEL admission at any provider since 1-Jan-2025 (based on discharge date).
    config:
      meta:
        owner:
          name: PeterSNHS
    columns:
      - name: patient_id
        description: "Unique patient identifier."
        tests:
          - not_null

      - name: hospital_number
        description: "Trust-provided patient identifier. (local patient identifier).
          Taken from most recent NEL admission from any provider."

      - name: local_authority
        description: "Most recent registered local authority based on GP practice
          neighbourhood."

      - name: gp_code
        description: "Registered GP practice code at most recent acute activity."

      - name: gp_name
        description: "Registered GP practice name at most recent acute activity."

      - name: local_authority_pds
        description: "Registered local authority on PDS."

      - name: gp_code_pds
        description: "Registered GP practice code on PDS."

      - name: gp_name_pds
        description: "Registered GP practice name on PDS."

      - name: age_at_most_recent_nel_admission
        description: "Age at most recent non-elective admission."

      - name: most_recent_nel_admission_date
        description: "Date of most recent non-elective admission at any provider."

      - name: most_recent_nel_discharge_date
        description: "Date of most recent non-elective discharge at any provider."

      - name: barnet_hospital_count
        description: "Count of distinct non-elective admissions at Barnet Hospital
          since 1-Jan-2025 (based on discharge date)."

      - name: barnet_hospital_flag
        description: "Flag (1/0) if patient had ≥1 non-elective admission at Barnet
          Hospital since 1-Jan-2025 (based on discharge date)."

      - name: RFL_ex_BH_count
        description: "Count of distinct non-elective admissions at Royal Free London
          sites excluding Barnet Hospital since 1-Jan-2025 (based on discharge date)."

      - name: RFL_ex_BH_flag
        description: "Flag (1/0) if patient had ≥1 non-elective admission at Royal
          Free London sites excluding Barnet Hospital since 1-Jan-2025 (based on discharge date)."

      - name: RFL_count
        description: "Count of distinct non-elective admissions at Royal Free London
          (RAL, RAP) since 1-Jan-2025 (based on discharge date)."

      - name: RFL_flag
        description: "Flag (1/0) if patient had ≥1 non-elective admission at Royal
          Free London (RAL, RAP) since 1-Jan-2025 (based on discharge date)."

      - name: NCLProvider_count
        description: "Count of distinct non-elective admissions at NCL providers (RAL,
          RAP, RKE, RRV) since 1-Jan-2025 (based on discharge date)."

      - name: NCLProvider_flag
        description: "Flag (1/0) if patient had ≥1 non-elective admission at NCL providers
          (RAL, RAP, RKE, RRV) since 1-Jan-2025 (based on discharge date)."

      - name: Non_NCLProvider_count
        description: "Count of distinct non-elective admissions at non-NCL providers
          since 1-Jan-2025 (based on discharge date)."

      - name: Non_NCLProvider_flag
        description: "Flag (1/0) if patient had ≥1 non-elective admission at non-NCL
          providers since 1-Jan-2025 (based on discharge date)."

      - name: nel_ip_admissions_last_24_months
        description: "Count of distinct non-elective inpatient admissions in past
          24 months (based on discharge date)."

      - name: nel_ip_admissions_last_12_months
        description: "Count of distinct non-elective inpatient admissions in past
          12 months (based on discharge date)."

      - name: nel_ip_admissions_last_6_months
        description: "Count of distinct non-elective inpatient admissions in past
          6 months (based on discharge date)."

      - name: heart_failure
        description: "Flag (1/0) if patient has ICD-10 I50* diagnosis (Heart Failure)."

      - name: copd
        description: "Flag (1/0) if patient has COPD or emphysema (ICD-10 J44*, J43*)."

      - name: dementia
        description: "Flag (1/0) if patient has dementia (ICD-10 F00–F03, G30)."

      - name: end_stage_renal_failure
        description: "Flag (1/0) if patient has ESRD or dialysis dependence (ICD-10
          N18.6, Z99.2)."

      - name: severe_interstitial_lung_disease
        description: "Flag (1/0) if patient has interstitial lung disease (ICD-10
          J84*)."

      - name: parkinsons_disease
        description: "Flag (1/0) if patient has Parkinson’s disease (ICD-10 G20*)."

      - name: chronic_kidney_disease
        description: "Flag (1/0) if patient has CKD (ICD-10 N18.*)."

      - name: liver_failure
        description: "Flag (1/0) if patient has hepatic failure (ICD-10 K72*, K70.4)."

      - name: alcohol_dependence
        description: "Flag (1/0) if patient has alcohol dependence syndrome (ICD-10
          F10.2*)."

      - name: bronchiectasis
        description: "Flag (1/0) if patient has bronchiectasis (ICD-10 J47*)."

      - name: atrial_fibrillation
        description: "Flag (1/0) if patient has atrial fibrillation/flutter (ICD-10
          I48*)."

      - name: cerebrovascular_disease
        description: "Flag (1/0) if patient has cerebrovascular disease (ICD-10 I60–I69)."

      - name: peripheral_vascular_disease
        description: "Flag (1/0) if patient has peripheral vascular disease (ICD-10
          I70.2*, I73.*, I74.*)."

      - name: pulmonary_heart_disease
        description: "Flag (1/0) if patient has pulmonary heart disease (ICD-10 I26–I28)."

      - name: coronary_heart_disease
        description: "Flag (1/0) if patient has coronary heart disease (ICD-10 I20–I25)."

      - name: osteoporosis
        description: "Flag (1/0) if patient has osteoporosis (ICD-10 M80*, M81*)."

      - name: rheumatoid_arthritis
        description: "Flag (1/0) if patient has rheumatoid arthritis (ICD-10 M05*,
          M06*)."

      - name: chronic_liver_disease
        description: "Flag (1/0) if patient has chronic liver disease (ICD-10 K70,
          K73–K74)."

      - name: hypertension
        description: "Flag (1/0) if patient has hypertensive disease (ICD-10 I10–I1A)."

      - name: frailty_falls
        description: "Flag (1/0) if patient has frailty or history of falls (ICD-10
          R54, Z91.81)."

      - name: is_on_pds
        description: "Binary flag for whether patient is registered at an NCL GP on
          PDS at time of running (1 if yes, 0 if no)."

      - name: total_high_risk_conditions
        description: "Sum of all high-risk conditions flags."
      
      - name: data_source_refresh_date
        description: "Refresh datetime of the int_myria_conditions table. This is when the death status and PDS are checked."
      
      - name: table_refresh_date
        description: "Refresh datetime of this table. Will usually be the same as data_source_refresh_date in normal dbt scheduling."
