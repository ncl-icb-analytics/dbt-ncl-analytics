
models:
  - name: pds_olids_reg_pass_direct_care
    description: |
      Practices passing PDS registration count validation.

      Use this for inner joins to filter datasets to practices with validated registration data.

      Validation: <2% variance OR <5 persons difference (same threshold as EMIS)
      Methodology: PDS All Registration Types Comparison
      Includes: validation_methodology column describing the test

    config:
      meta:
        owner:
          name: Eddie Davison
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1
          severity: warn

  - name: pds_olids_reg_fail_direct_care
    description: |
      Practices failing PDS registration count validation.

      These practices require investigation before use in analyses.

      Validation: ≥2% variance AND ≥5 persons difference
      Methodology: PDS All Registration Types Comparison
      Includes: validation_methodology column and issue_category (2-5%, 5-20%, 20%+)

    config:
      meta:
        owner:
          name: Eddie Davison
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1

  - name: pds_olids_reg_comparison_all_direct_care
    description: |
      Complete PDS registration comparison for all practices with categorisation.

      Categories: Major Difference (≥20%), Minor Difference (5-20%), Good Match (<5%), No Data

      Methodology: PDS All Registration Types Comparison using merged NHS numbers

    config:
      meta:
        owner:
          name: Eddie Davison
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1

  - name: emis_olids_reg_pass_direct_care
    description: |
      Practices passing EMIS Regular registration count validation.

      Use this for inner joins to filter datasets to practices with validated Regular registration data.

      Validation: <2% variance OR <5 persons difference
      Snapshot: Dynamic (from EMIS extract date)
      Registration Type: Regular only (excludes Temporary, Emergency, etc.)

    config:
      meta:
        owner:
          name: Eddie Davison
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1

  - name: emis_olids_reg_fail_direct_care
    description: |
      Practices failing EMIS Regular registration count validation.

      These practices require investigation before use in analyses.

      Issue Categories: 2-5% Variance, 5-20% Variance, 20%+ Variance, Missing Data

      Validation: ≥2% variance AND ≥5 persons difference
      Snapshot: Dynamic (from EMIS extract date)
      Registration Type: Regular only

    config:
      meta:
        owner:
          name: Eddie Davison
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1

  - name: emis_olids_reg_comparison_all_direct_care
    description: |
      Complete EMIS Regular registration comparison for all practices using acceptance criteria.

      Categories: Meets Criteria, 2-5% Variance, 5-20% Variance, 20%+ Variance, Missing Data

      Acceptance Criteria:
      - Aggregate: <1% variance across all practices
      - Per-practice: <2% variance OR <5 persons difference

      Snapshot: Dynamic (from EMIS extract date)
      Registration Type: Regular only

    config:
      meta:
        owner:
          name: Eddie Davison
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1

  - name: emis_olids_reg_aggregate_validation_direct_care
    description: |
      Aggregate-level validation of OLIDS Regular registrations against EMIS list size.

      Returns a single row showing whether the overall system meets the <1% variance acceptance criteria.

      Acceptance Criteria: <1% variance in aggregate across all practices
      Snapshot: Dynamic (from EMIS extract date)

    config:
      meta:
        owner:
          name: Eddie Davison
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1
