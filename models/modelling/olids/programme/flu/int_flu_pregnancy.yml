models:
  - name: int_flu_pregnancy
    description: 'Flu vaccination eligibility for pregnant women using campaign timing
      logic.

      Key Features:

      • Two eligibility scenarios: pregnant at campaign start (9 months before) or
      became pregnant during campaign

      • Campaign timing logic for flu season protection

      • Age restriction: minimum 12 years for pregnancy flu vaccination

      • Uses PREG_COD and PREGDEL_COD for pregnancy and delivery tracking

      • Generates data for current and previous flu campaigns automatically

      Purpose: Identify pregnant women eligible for flu vaccination during flu season
      timing.'
    config:
      meta:
        indicator:
          id: "FLU_PREGNANCY"
          type: "PROGRAMME"
          category: "FLU"
          clinical_domain: "Maternity"
          name_short: "Flu Eligible Pregnancy"
          description_short: "Pregnant women eligible for flu vaccination"
          description_long: >
            Flu vaccination eligibility for pregnant women using campaign timing logic.
            Two scenarios: women pregnant 9 months before campaign start (with no
            subsequent delivery)
            or women who became pregnant between campaign start and reference date.
            Uses PREG_COD
            and PREGDEL_COD codes. Minimum age requirement of 12 years for pregnancy
            vaccination.
          is_qof: false
          source_column: "person_id"
          sort_order: "FLU_16_PREGNANCY"
          usage_contexts:
            - "COVID_AND_FLU_DASHBOARD"
            - "FLU_REPORTING"
          code_clusters:
            - cluster_id: "PREG_COD"
              category: "INCLUSION"
            - cluster_id: "PREGDEL_COD"
              category: "REFINEMENT"
          thresholds:
            - population_group: "PREGNANT_WOMEN"
              threshold_type: "AGE_ELIGIBILITY"
              threshold_value: "12"
              threshold_operator: "AT_OR_ABOVE"
              threshold_unit: "years"
              description: "Minimum age for pregnancy flu vaccination"
              sort_order: 1
            - population_group: "CAMPAIGN_TIMING"
              threshold_type: "PREGNANCY_PERIOD"
              threshold_value: "9"
              threshold_operator: "LOOKBACK"
              threshold_unit: "months"
              description: "Pregnancy eligibility lookback period from campaign start"
              sort_order: 2

        owner:
          name: EddieDavison92
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - campaign_id
            - person_id
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1

    columns:
      - name: campaign_id
        description: 'Flu campaign identifier (e.g., flu_2024_25, flu_2023_24)'
        tests:
          - not_null
      - name: campaign_category
        description: 'Category of eligibility criteria (always "At-Risk Group")'
      - name: risk_group
        description: 'Risk group classification (always "Pregnancy")'
      - name: person_id
        description: 'Unique identifier for the person'
        tests:
          - not_null
      - name: qualifying_event_date
        description: 'Date of qualifying pregnancy event'
      - name: reference_date
        description: 'Campaign reference date used for eligibility assessment'
      - name: description
        description: 'Description of eligibility criteria'
      - name: birth_date_approx
        description: 'Approximate birth date used for age calculation'
      - name: age_months_at_ref_date
        description: 'Age in months at campaign reference date (minimum 12 years required)'
      - name: age_years_at_ref_date
        description: 'Age in years at campaign reference date'
      - name: created_at
        description: 'Audit timestamp for record creation (campaign audit end date)'
