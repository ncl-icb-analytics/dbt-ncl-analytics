version: 2
models:
  - name: int_ltc_lcs_rs_dm_pg3b_mrb
    description: |
      Diabetes Register Priority Group 3B - Moderate Risk B identification.

      Patients on the diabetes register (excluding PG1, PG2, PG3A) are included if:
      - Rule 2: HbA1c 58-75 (direct inclusion)
      - OR Rule 3+4-7: HbA1c 48-58 AND any of:
        - Erectile dysfunction, diabetic retinopathy, BMI >35, diabetic neuropathy
        - Diabetic foot at moderate/high risk, heart failure (first episode)
        - GLP-1/insulin medications in last 6 months, claudication/atherosclerosis
        - eGFR 45-49, ACR 3-30, ABPM BP â‰¥140/90
    tests:
      - dbt_utils.at_least_one:
          column_name: person_id
    columns:
      - name: person_id
        tests:
          - not_null
          - unique
