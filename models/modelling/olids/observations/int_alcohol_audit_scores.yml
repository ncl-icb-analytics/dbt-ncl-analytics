version: 2

models:
  - name: int_alcohol_audit_scores
    description: 'AUDIT and AUDIT-C alcohol screening assessments with UK-specific
      risk thresholds.

      One row per AUDIT/AUDIT-C observation using AUDITC_COD and AUDIT_COD clusters
      with detailed categorisation and intervention flags.'

    config:
      meta:
        owner:
          name: EddieDavison92
    tests:
      - cluster_ids_exist:
          cluster_ids: AUDITC_COD, AUDIT_COD
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - id
            - source_cluster_id

    columns:
      - name: person_id
        description: Unique identifier for the person
        tests:
          - not_null

      - name: id
        description: Identifier for the observation (may not be unique due to 
          multiple concept mappings)
        tests:
          - not_null

      - name: clinical_effective_date
        description: Date when the AUDIT assessment was performed
        tests:
          - not_null

      - name: audit_score
        description: Numeric AUDIT or AUDIT-C score value

      - name: audit_type
        description: Type of AUDIT assessment (AUDIT-C or Full AUDIT)

      - name: is_valid_score
        description: Flag indicating if score is within valid range for the 
          instrument

      - name: risk_category
        description: Clinical risk category based on score thresholds

      - name: auditc_positive_screen
        description: Flag for AUDIT-C scores â‰¥5 indicating positive screen for 
          potential harm

      - name: requires_specialist_intervention
        description: Flag for scores indicating need for specialist clinical 
          intervention

      - name: brief_intervention_indicated
        description: Flag for scores meeting threshold for brief intervention

      - name: simplified_risk_level
        description: Simplified risk categorisation (Low/Moderate/High) for 
          aggregation

      - name: gender
        description: Person's gender used for risk stratification (where 
          applicable)
