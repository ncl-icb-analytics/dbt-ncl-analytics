version: 2
models:
  - name: int_cholesterol_latest
    description: 'Most recent valid cholesterol measurement per person for cardiovascular risk assessment and statin therapy decision-making.

      One row per person with their latest cholesterol including clinical cholesterol categorisation and data quality validation.'

    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1

    columns:
      - name: person_id
        tests:
          - unique
          - not_null

    config:
      meta:
        indicator:
          id: "CHOLESTEROL_LATEST"
          type: "PATHOLOGY"
          category: "LABORATORY_RESULT"
          clinical_domain: "Cardiometabolic"
          name_short: "Latest Cholesterol"
          description_short: "Most recent total cholesterol measurement for cardiovascular risk assessment"
          description_long: >
            Latest valid total cholesterol measurement per person supporting cardiovascular risk assessment
            and statin therapy decision-making. Provides current lipid profile status with clinical
            categorisation for cardiovascular risk stratification (<5 mmol/L desirable, <4 mmol/L secondary
            prevention target, â‰¥6.2 mmol/L high requiring intervention). Key biomarker for primary and
            secondary cardiovascular prevention programmes, diabetes care pathways, and lipid management
            protocols. Supports QOF reporting and clinical guideline compliance monitoring.
          is_qof: false
          source_column: "cholesterol_value"
          usage_contexts:
            - "LABORATORY_MONITORING"
          code_clusters:
            - cluster_id: "CHOL_COD"
              category: "INCLUSION"
          thresholds:
            # Cardiovascular Risk Targets
            - population_group: "PRIMARY_PREVENTION"
              threshold_type: "RISK_REDUCTION_TARGET"
              threshold_value: "5"
              threshold_operator: "BELOW"
              threshold_unit: "mmol/L"
              description: "Primary prevention cholesterol target"
              sort_order: 1
            - population_group: "SECONDARY_PREVENTION"
              threshold_type: "RISK_REDUCTION_TARGET"
              threshold_value: "4"
              threshold_operator: "BELOW"
              threshold_unit: "mmol/L"
              description: "Secondary prevention cholesterol target for established CVD"
              sort_order: 2
            - population_group: "DIABETES"
              threshold_type: "DIABETES_TARGET"
              threshold_value: "5"
              threshold_operator: "BELOW"
              threshold_unit: "mmol/L"
              description: "Cholesterol target for diabetes patients"
              sort_order: 3
            # Clinical Categories
            - population_group: "ALL"
              threshold_type: "DESIRABLE"
              threshold_value: "5"
              threshold_operator: "BELOW"
              threshold_unit: "mmol/L"
              description: "Desirable cholesterol level"
              sort_order: 4
            - population_group: "ALL"
              threshold_type: "BORDERLINE_HIGH"
              threshold_value: "6.2"
              threshold_operator: "BELOW"
              threshold_unit: "mmol/L"
              description: "Borderline high cholesterol requiring lifestyle advice"
              sort_order: 5
            - population_group: "ALL"
              threshold_type: "HIGH"
              threshold_value: "6.2"
              threshold_operator: "AT_OR_ABOVE"
              threshold_unit: "mmol/L"
              description: "High cholesterol requiring intervention"
              sort_order: 6
