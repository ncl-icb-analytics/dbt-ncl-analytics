version: 2

models:
  - name: int_polypharmacy_medications_current
    description: |
      Current repeat medications within polypharmacy scope (BNF chapters 1-4, 6-10).

      Grain: One row per person Ã— medication (current polypharmacy-scope medications only)

      Inclusion criteria:
      - Current repeat prescriptions (from int_medication_orders_repeat_current)
      - BNF chapters 1-4, 6-10 only (INNER JOIN with polypharmacy medications list)
      - Active supply (order date + duration >= today)

      Enriched with BNF details for medication identification and categorization.

    columns:
      - name: person_id
        description: Person identifier
        data_tests:
          - not_null

      - name: mapped_concept_code
        description: SNOMED CT code for the medication
        data_tests:
          - not_null

      - name: bnf_code
        description: BNF code for the medication
        data_tests:
          - not_null

      - name: bnf_chapter
        description: BNF chapter (01-04, 06-10)
        data_tests:
          - not_null

      - name: bnf_name
        description: BNF name/description of the medication

      - name: latest_order_date
        description: Date of most recent medication order
        data_tests:
          - not_null

      - name: latest_duration
        description: Duration in days for most recent order
