version: 2
models:
  - name: int_ndh_diagnoses_all
    description: 'Non-diabetic hyperglycaemia diagnosis observations for QOF register data collection and diabetes prevention pathway coordination.

      One row per NDH, IGT, or pre-diabetes diagnosis observation using NDH_COD, IGT_COD, and PRD_COD clusters with age restrictions (â‰¥18 years).'
    columns:
      - name: id
        description: 'Unique identifier for the clinical observation'
        tests:
          - unique
          - not_null

      - name: person_id
        description: 'Patient identifier'

      - name: clinical_effective_date
        description: 'Date when NDH/IGT/pre-diabetes diagnosis was clinically effective'

      - name: concept_code
        description: 'Clinical code for NDH, IGT, or pre-diabetes diagnosis'

      - name: concept_display
        description: 'Human-readable description of the clinical code'

      - name: source_cluster_id
        description: 'QOF cluster identifier (NDH_COD, IGT_COD, or PRD_COD)'

      - name: is_ndh_diagnosis_code
        description: 'Flag indicating non-diabetic hyperglycaemia code (NDH_COD cluster)'

      - name: is_igt_diagnosis_code
        description: 'Flag indicating impaired glucose tolerance code (IGT_COD cluster)'

      - name: is_pre_diabetes_diagnosis_code
        description: 'Flag indicating pre-diabetes code (PRD_COD cluster)'

      - name: is_any_ndh_type_code
        description: 'Flag indicating any type of NDH-related diagnosis code'

      - name: is_diagnosis_code
        description: 'Flag indicating any NDH/IGT/pre-diabetes diagnosis code'

    tests:
      - dbt_utils.at_least_one:
          column_name: id
      - cluster_ids_exist:
          cluster_ids: IGT_COD, NDH_COD, PRD_COD
