version: 2

models:
  - name: int_myria_conditions
    description: >
      For project Myria.
      Aggregates patient-level activity flags for non-elective inpatient admissions
      in past two years with site- and provider-specific indicators. (Time periods for NEL
      counts and flags are based on discharge date).
      Excludes patients who died before the start of this month. Flags patients that have received
      diagnoses for certain conditions in any POD.
    config:
      meta:
        owner:
          name: PeterSNHS
    columns:
      - name: patient_id
        description: "Unique patient identifier."
        tests:
          - not_null

      - name: hospital_number_most_recent_nel_bh
        description: "Trust-provided patient identifier. (local patient identifier).
          Taken from most recent BH NEL admission."
      
      - name: hospital_number_most_recent_nel_any_provider
        description: "Trust-provided patient identifier. (local patient identifier).
          Taken from most recent NEL admission from any provider."

      - name: local_authority
        description: "Most recent registered local authority based on GP practice."

      - name: gp_code
        description: "Registered GP practice code at most recent acute activity."

      - name: gp_name
        description: "Registered GP practice name at most recent acute activity."

      - name: local_authority_pds
        description: "Registered local authority on PDS."

      - name: gp_code_pds
        description: "Registered GP practice code on PDS."

      - name: gp_name_pds
        description: "Registered GP practice name on PDS."

      - name: age_at_most_recent_nel_admission
        description: "Age at most recent non-elective admission."

      - name: most_recent_nel_admission_date
        description: "Date of most recent non-elective admission."
      
      - name: most_recent_nel_discharge_date
        description: "Date of most recent non-elective discharge."

      - name: most_recent_nel_admission_date_bh
        description: "Date of most recent non-elective admission at Barnet Hospital."
      
      - name: most_recent_nel_discharge_date_bh
        description: "Date of most recent non-elective discharge at Barnet Hospital."

      - name: barnet_hospital_flag
        description: "Flag (1/0) if patient had ≥1 non-elective admission at Barnet
          Hospital between 01-Jan-2025 and start of current month (based on discharge date)."

      - name: barnet_hospital_count
        description: "Count of distinct non-elective admissions at Barnet Hospital
          between 01-Jan-2025 and start of current month (based on discharge date)."

      - name: RFL_ex_BH_flag
        description: "Flag (1/0) if patient had ≥1 non-elective admission at Royal
          Free London sites excluding Barnet Hospital between 01-Jan-2025 and start of current month (based on discharge date)."

      - name: RFL_ex_BH_count
        description: "Count of distinct non-elective admissions at Royal Free London
          sites excluding Barnet Hospital between 01-Jan-2025 and start of current month (based on discharge date)."

      - name: RFL_flag
        description: "Flag (1/0) if patient had ≥1 non-elective admission at Royal
          Free London (RAL, RAP) between 01-Jan-2025 and start of current month (based on discharge date)."

      - name: RFL_count
        description: "Count of distinct non-elective admissions at Royal Free London
          (RAL, RAP) between 01-Jan-2025 and start of current month (based on discharge date)."

      - name: NCLProvider_flag
        description: "Flag (1/0) if patient had ≥1 non-elective admission at NCL providers
          (RAL, RAP, RKE, RRV) between 01-Jan-2025 and start of current month (based on discharge date)."

      - name: NCLProvider_count
        description: "Count of distinct non-elective admissions at NCL providers (RAL,
          RAP, RKE, RRV) between 01-Jan-2025 and start of current month (based on discharge date)."

      - name: Non_NCLProvider_flag
        description: "Flag (1/0) if patient had ≥1 non-elective admission at non-NCL
          providers between 01-Jan-2025 and start of current month (based on discharge date)."

      - name: Non_NCLProvider_count
        description: "Count of distinct non-elective admissions at non-NCL providers
          between 01-Jan-2025 and start of current month (based on discharge date)."

      - name: nel_ip_admissions_last_24_months
        description: "Count of distinct non-elective inpatient admissions in last
          2 years (based on discharge date)."

      - name: nel_ip_admissions_last_12_months
        description: "Count of distinct non-elective inpatient admissions in last
          12 months (based on discharge date)."

      - name: nel_ip_admissions_last_6_months
        description: "Count of distinct non-elective inpatient admissions in last
          6 months (based on discharge date)."

      - name: heart_failure
        description: >
          Flag (1/0) if patient had diagnosis code starting with ICD-10 I50 (Heart
          Failure).
          Requires proxy for 'severe' heart failure  e.g. based on ≥2 admissions in
          12 months or related acute events.

      - name: copd
        description: "Flag (1/0) if patient has COPD or emphysema (ICD-10 J44*, J43*)."

      - name: dementia
        description: "Flag (1/0) if patient has dementia (ICD-10 F00–F03, G30)."

      - name: end_stage_renal_failure
        description: "Flag (1/0) if patient has ESRD or dialysis dependence (ICD-10
          N18.6, Z99.2)."

      - name: severe_interstitial_lung_disease
        description: "Flag (1/0) if patient has interstitial lung disease (ICD-10
          J84*)."

      - name: parkinsons_disease
        description: "Flag (1/0) if patient has Parkinson’s disease (ICD-10 G20*)."

      - name: chronic_kidney_disease
        description: "Flag (1/0) if patient has CKD (ICD-10 N18.*)."

      - name: liver_failure
        description: "Flag (1/0) if patient has hepatic failure (ICD-10 K72*, K70.4)."

      - name: alcohol_dependence
        description: "Flag (1/0) if patient has alcohol dependence syndrome (ICD-10
          F10.2*)."

      - name: bronchiectasis
        description: "Flag (1/0) if patient has bronchiectasis (ICD-10 J47*)."

      - name: atrial_fibrillation
        description: "Flag (1/0) if patient has atrial fibrillation/flutter (ICD-10
          I48*)."

      - name: cerebrovascular_disease
        description: "Flag (1/0) if patient has cerebrovascular disease (ICD-10 I60–I69)."

      - name: peripheral_vascular_disease
        description: "Flag (1/0) if patient has peripheral vascular disease (ICD-10
          I70.2*, I73.*, I74.*)."

      - name: pulmonary_heart_disease
        description: "Flag (1/0) if patient has pulmonary heart disease (ICD-10 I26–I28)."

      - name: coronary_heart_disease
        description: "Flag (1/0) if patient has coronary heart disease (ICD-10 I20–I25)."

      - name: osteoporosis
        description: "Flag (1/0) if patient has osteoporosis (ICD-10 M80*, M81*)."

      - name: rheumatoid_arthritis
        description: "Flag (1/0) if patient has rheumatoid arthritis (ICD-10 M05*,
          M06*)."

      - name: chronic_liver_disease
        description: "Flag (1/0) if patient has chronic liver disease (ICD-10 K70,
          K73–K74)."

      - name: hypertension
        description: "Flag (1/0) if patient has hypertensive disease (ICD-10 I10–I1A)."

      - name: frailty_falls
        description: "Flag (1/0) if patient has frailty or history of falls (ICD-10
          R54, Z91.81)."
      - name: is_on_pds
        description: "Binary flag for whether patient is registered at an NCL GP on
          PDS at time of running (1 if yes, 0 if no)."
