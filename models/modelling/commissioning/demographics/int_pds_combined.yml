version: 2
models:
- name: int_pds_combined
  description: Personal Demographics Service latest record for each patient in a combined table.
  tests:
  - dbt_utils.at_least_one:
      column_name: sk_patient_id
  columns:
  - name: sk_patient_id
    description: Surrogate key patient identifier (pseudonymised NHS number)
    tests:
    - not_null
    - unique
  - name: current_record_person
    data_type: boolean
    description: TRUE if the person appears in DATA_LAKE.PDS.PDS_PERSON with no defined end date, identifies people that are currently registered to NCL or a resident of NCL
  - name: record_end_date
    data_type: date
    description: When current_record_person is False, contains the date the record was no longer associated with NCL, otherwise NULL
  - name: year_month_of_birth
    data_type: date
    description: The month the person was born, set to the 1st of the month to save as a DATE variable
  - name: gender_code
    data_type: varchar
    description: Code for the person's gender, map using the dictionary.dbo tables
  - name: date_of_death
    data_type: date
    description: Date the person died, NULL if no record of death
  - name: preferred_language_code
    data_type: varchar
    description: Shorthand name for preferred language if on record
  - name: interpreter_required_code
    data_type: varchar
    description: Flag variable if the person requires an intepreter for appointments
  - name: current_record_registered
    data_type: boolean
    description: TRUE if the person appears in DATA_LAKE.PDS_PATIENT_CARE_PRACTICE with no defined end date, identifies people that are currently registered to NCL
  - name: practice_code
    data_type: varchar
    description: Organisation code of the person's registered GP Practice, NULL implies not registered to any practice
  - name: current_record_resident
    data_type: boolean
    description: TRUE if the person appears in DATA_LAKE.PDS_ADDRESS with no defined end date, identifies people that are currently an NCL resident
  - name: postcode_sector
    data_type: varchar
    description: First half of the postcode for the person's residence, NULL implies no known residence
  - name: lsoa_21
    data_type: varchar
    description: LSOA code of residence using the 2021 LSOA definitions, NULL implies no known residence