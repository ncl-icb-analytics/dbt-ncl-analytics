version: 2

models:
  - name: int_wl_current
    description: >
      All active waiting lists from WLMDS as of most recent census date (corrected to Sunday census dates). Used for care coordination across providers.
    config:
      materialized: view
    columns:
      - name: week_ending_date
        description: Week ending (census) date aligned to Sunday (e.g. if occurs on Monday, is moved to previous Sunday)
      - name: sk_patient_id
        description: Surrogate key for patient identifier
      - name: local_patient_identifier
        description: Local patient identifier
      - name: person_stated_gender_code
        description: Gender code as stated by the person
      - name: ethnic_category
        description: Ethnic category of the patient
      - name: lsoa_2021
        description: Lower Super Output Area (2021)
      - name: age_at_week_ending_date
        description: Age of patient at week ending date
      - name: age_at_referral_to_treatment_period_start_date
        description: Age at start of referral to treatment period
      - name: age_band_week_ending_date
        description: Age band at week ending date
      - name: age_band_at_referral_to_treatment_period_start_date
        description: Age band at referral start
      - name: commissioner_code
        description: Code of commissioning organisation
      - name: practice_code
        description: Code of patient's GP practice
      - name: ccg_of_practice
        description: Clinical Commissioning Group of practice
      - name: ccg_of_residence
        description: Clinical Commissioning Group of residence
      - name: waiting_list_type
        description: Type of waiting list
      - name: provider_code
        description: Code of provider organisation
      - name: provider_site_code
        description: Site code of treatment provider
      - name: referring_organisation_code
        description: Code of referring organisation
      - name: referral_request_received_date
        description: Date referral request was received
      - name: original_referral_request_received_date
        description: Original referral request date
      - name: referral_to_treatment_period_start_date
        description: Start date of referral to treatment period
      - name: current_pathway_period_start_date
        description: Start date of current pathway period
      - name: referral_identifier
        description: Unique referral identifier
      - name: patient_pathway_identifier
        description: Identifier for patient pathway
      - name: organisation_code_patient_pathway_identifier_issuer
        description: Issuer of patient pathway identifier
      - name: source_of_referral
        description: Source of referral
      - name: main_specialty_code
        description: Main specialty code
      - name: treatment_function_code
        description: Treatment function code
      - name: consultant_code
        description: Consultant code
      - name: outpatient_future_appointment_date
        description: Future outpatient appointment date
      - name: due_date
        description: Due date for treatment
      - name: outpatient_appointment_date
        description: Date of outpatient appointment
      - name: date_last_attended
        description: Last attended date
      - name: last_dna_date
        description: Last Did Not Attend date
      - name: cancellation_date
        description: Appointment cancellation date
      - name: outcome_of_attendance_code
        description: Outcome code of attendance
      - name: tci_date
        description: To Come In date
      - name: referral_to_treatment_period_status
        description: Status of referral to treatment period
      - name: decision_to_admit_date
        description: Date of decision to admit
      - name: proposed_procedure_opcs_code
        description: OPCS code for proposed procedure
      - name: admission_method_code
        description: Admission method code
      - name: priority_type_code
        description: Priority type code
      - name: procedure_priority_code
        description: Procedure priority code
      - name: diagnostic_priority_code
        description: Diagnostic priority code
      - name: inclusion_on_cancer_ptl
        description: Inclusion on cancer PTL
      - name: intended_management_code
        description: Intended management code
      - name: transfer_status
        description: Transfer status
      - name: mutual_aid_accepting_provider
        description: Mutual aid accepting provider
      - name: first_activity_date
        description: Date of first activity
      - name: first_activity_type
        description: Type of first activity
      - name: decision_to_treat_date
        description: Date of decision to treat
      - name: tci_date_provided
        description: Provided TCI date
      - name: preliminary_screening_and_risk_assessment_date
        description: Date of preliminary screening and risk assessment
      - name: date_and_time_data_set_created
        description: Timestamp of dataset creation
      - name: open_pathways
        description: Flag indicating open pathway (always 1)
tests:
- dbt_expectations.expect_table_row_count_to_be_between:
    min_value: 1
- dbt_utils.unique_combination_of_columns:
    combination_of_columns:
    - pseudo_nhs_number
    - referral_identifier
    - patient_pathway_identifier
    - tfc_code
    - provider_code
    - provider_site_code
    - week_ending_date
    - severity: warn