version: 2

models:
  - name: int_sus_ip_encounters
    description: "Event history for admitted patient care encounters from SUS data"
    columns:
      - name: visit_occurrence_id
        data_type: number
        description: "Primary key for the encounter within SUS"
        data_tests:
          - unique:
              config:
                severity: error
                error_if: ">100"
                warn_if: ">10"        
          - not_null

      - name: sk_patient_id
        data_type: varchar
        description: "Common commissioning patient identifier"

      - name: source
        data_type: varchar
        description: "Commissioning data source of record"

      - name: organisation_id
        data_type: varchar
        description: "Provider organisation identifier"

      - name: organisation_name
        data_type: varchar
        description: "Provider organisation name"

      - name: site_id
        data_type: varchar
        description: "Site identifier"

      - name: site_name
        data_type: varchar
        description: "Site name"
      
      - name: start_date
        data_type: timestamp_ntz
        description: "Spell start date"

      - name: end_date
        data_type: timestamp_ntz
        description: "Spell end date"

      - name: duration
        data_type: number
        description: "Length of stay in days. This value is an output of the grouper process and represents the sum of the Episode Adjusted Durations for non-excluded episodes in the spell."

      - name: duration_to_date
        data_type: number
        description: "Length of stay in days, including ongoing stays calculated to current date"

      - name: admission_method
        data_type: varchar
        description: "Method of admission"

      - name: admission_method_group
        data_type: varchar
        description: "Group of admission method"

      - name: admission_patient_classification
        data_type: varchar
        description: "Patient classification at admission"
      
      - name: pod
        data_type: varchar
        description: "Point of delivery, based on admission method, patient classification and length of stay"

      - name: flat_diagnosis_codes
        data_type: varchar
        description: "Primary and secondary diagnosis codes for the spell (as derived by the HRG grouper) flattened into a single field"

      - name: primary_treatment
        data_type: varchar
        description: ""

      - name: main_specialty_code
        data_type: varchar
        description: "The specialty (code) in which the consultant is contracted or recognised and the code identifies a specialty as designated by Royal Colleges derived from the dominant episode of the spell."

      - name: main_specialty_name
        data_type: varchar
        description: "The specialty (name) in which the consultant is contracted or recognised and the code identifies a specialty as designated by Royal Colleges derived from the dominant episode of the spell."

      - name: main_specialty_category
        data_type: varchar
        description: "The specialty (category) in which the consultant is contracted or recognised and the code identifies a specialty as designated by Royal Colleges derived from the dominant episode of the spell."
     
      - name: treatment_function_code
        data_type: varchar
        description: "TREATMENT FUNCTION CODE is recorded to report the specialised service within which the PATIENT is treated. It is based on MAIN SPECIALTY but also includes approved sub-specialties and treatment specialties used by lead CARE PROFESSIONALS including CONSULTANTS. TREATMENT FUNCTION, rather than the Royal College or Faculty specialty, is required on most activity returns and in the Commissioning Data Sets."

      - name: treatment_function_code_desc
        data_type: varchar
        description: "TREATMENT FUNCTION CODE is recorded to report the specialised service within which the PATIENT is treated. It is based on MAIN SPECIALTY but also includes approved sub-specialties and treatment specialties used by lead CARE PROFESSIONALS including CONSULTANTS. TREATMENT FUNCTION, rather than the Royal College or Faculty specialty, is required on most activity returns and in the Commissioning Data Sets."

      - name: hrg_code
        data_type: varchar
        description: "The spell level HRG returned by the grouper as a result of grouping non-excluded episodes."

      - name: spec_comm_flag
        data_type: varchar
        description: "Specialised Commission Flag"

      - name: spec_comm
        data_type: varchar
        description: "Specialised Commission Code"

      - name: type
        data_type: varchar
        description: "An amalgamation of admission_type and sub_type where type = 'NON'. Type is derived from 2 sources (TBC). Subtype is derived from the method of admission to a provider spell."

      - name: cost
        data_type: number
        description: "The final calculated national price from SUS"

      - name: age_at_event
        data_type: number
        description: "The age at the start of the dominant episode."

      - name: gender_at_event
        data_type: varchar
        description: "Ambiguous: 'current gender of the patient.'"

      - name: gender_desc_at_event
        data_type: varchar
        description: ""

      - name: ethnicity_at_event
        data_type: varchar
        description: "Ambiguous: ode that indicates the ethnicity of the patient, this is a value that the patients themselves specify. This field will be populated with an alphabetic value from A to Z; consult the NHS data dictionary."

      - name: ethnicity_desc_at_event
        data_type: varchar
        description: ""

      - name: postcode_district_at_event
        data_type: varchar
        description: "Ambiguoius: The first part of the patient's postcode (outward code) at the time of the event."

      - name: lsoa_11_at_event
        data_type: varchar
        description: ""

      - name: lad_at_event
        data_type: varchar
        description: ""

      - name: imd_at_event
        data_type: varchar
        description: ""

      - name: reg_practice_at_event
        data_type: varchar
        description: ""

      - name: visit_occurrence_type
        data_type: varchar
        description: ""

