version: 2

models:
  - name: int_comm_primary_summary
    description: > 
      Standardized summary of primary clinical information from commissioning encounters.
      Combines primary diagnoses, procedures, treatments, and investigations from A&E attendances (ECDS),
      admitted patient care spells, and outpatient appointments into a unified structure.
      Each row represents one encounter with standardized primary clinical coding fields.
    config:
      meta:
        owner:
          name: Emily Baldwin
    columns:
      - name: visit_occurrence_id
        data_type: number
        description: "Unique identifier for the visit occurrence within SUS"
        data_tests:
          - unique
          - not_null

      - name: start_date
        data_type: timestamp_ntz
        description: "Date of the encounter (arrival date for A&E, admission date for inpatient, appointment date for outpatient)"

      - name: primary_complaint
        data_type: varchar
        description: "Primary complaint code (SNOMED) from A&E attendances. Null for inpatient and outpatient encounters."

      - name: primary_diagnosis_icd10
        data_type: varchar
        description: "Primary diagnosis code in ICD-10 format. Cleaned using clean_icd10_code macro for inpatient and outpatient encounters."

      - name: primary_diagnosis_snomed
        data_type: varchar
        description: "Primary diagnosis code in SNOMED format. Available for A&E attendances, null for inpatient and outpatient encounters."

      - name: primary_treatment_snomed
        data_type: varchar
        description: "Primary treatment code in SNOMED format. Available for A&E attendances, null for inpatient and outpatient encounters."

      - name: primary_investigation_snomed
        data_type: varchar
        description: "Primary investigation code in SNOMED format. Available for A&E attendances, null for inpatient and outpatient encounters."

      - name: primary_procedure_opcs4
        data_type: varchar
        description: "Primary procedure code in OPCS-4 format. Available for inpatient spells and outpatient appointments, null for A&E attendances."

      - name: core_hrg
        data_type: varchar
        description: "Core Healthcare Resource Group (HRG) code used for commissioning and tariff calculation"

      - name: main_specialty
        data_type: varchar
        description: "Main specialty code of the care professional responsible for the encounter"

      - name: treatment_function
        data_type: varchar
        description: "Treatment function code. Available for inpatient and outpatient encounters, null for A&E attendances."

      - name: source
        data_type: varchar
        description: "Source system identifier: 'SUS_ECDS' for A&E attendances, 'SUS_APC' for admitted patient care, 'SUS_OP' for outpatient appointments"
        data_tests:
          - not_null
          - accepted_values:
              values: ['SUS_ECDS', 'SUS_APC', 'SUS_OP']
