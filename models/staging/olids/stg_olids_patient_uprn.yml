version: 2
models:
- name: stg_olids_patient_uprn
  description: Patient address matching to Unique Property Reference Numbers (UPRNs)
    for geographical analysis. Deduplicated by id and filtered to exclude deleted
    records.
  columns:
  - name: id
    description: Primary key - unique identifier for this UPRN match
    tests:
    - unique
    - not_null
  - name: registrar_event_id
    description: Registrar event identifier
  - name: masked_uprn
    description: Masked Unique Property Reference Number
  - name: masked_usrn
    description: Masked Unique Street Reference Number
  - name: masked_postcode
    description: Masked postcode
  - name: address_format_quality
    description: Quality indicator for address format
  - name: post_code_quality
    description: Quality indicator for postcode
  - name: matched_with_assign
    description: Boolean or indicator for matching with assignment
  - name: qualifier
    description: Qualifier for the address match
  - name: uprn_property_classification
    description: Property classification code
  - name: algorithm
    description: Algorithm used for address matching
  - name: match_pattern
    description: Pattern used for the address match
  - name: lds_id
    description: LDS system identifier
  - name: lds_registrar_event_id
    description: LDS registrar event identifier
  - name: record_owner_organisation_code
    description: Organisation code of the record owner
  - name: lds_datetime_data_acquired
    description: Datetime when data was acquired by LDS
  - name: lds_initial_data_received_date
    description: Date when data was initially received by LDS
  - name: lds_start_date_time
    description: LDS datetime stamp from which the record version was correct - used
      for deduplication to get the latest record
  - name: lds_is_deleted
    description: Deletion flag - records with TRUE are filtered out in this staging
      layer
  - name: lds_record_id
    description: LDS assigned unique identifier for the source record version
  tests:
  - dbt_expectations.expect_table_row_count_to_be_between:
      min_value: 1
