models:
  - name: stg_sus_apc_spell_episodes_clinical_coding_procedure_opcs
    description: SUS APC episode clinical procedures (OPCS-4)
    config:
      meta:
        owner:
          name: EddieDavison92
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - primarykey_id
            - episodes_id
            - opcs_id
          config:
            severity: error
            error_if: ">1000"
            warn_if: ">10"
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1
    columns:
      - name: primarykey_id
        description: Primary key from main APC spell (FK)
        tests:
          - not_null
      - name: episodes_id
        description: Episode identifier within the spell
        tests:
          - not_null
      - name: opcs_id
        description: OPCS procedure identifier within the episode
        tests:
          - not_null
      - name: rownumber_id
        description: Row number for ordering procedures
        tests:
          - not_null
      - name: code
        description: OPCS-4 procedure code
