version: 2

models:
  - name: stg_sus_apc_spell_episodes
    description: ""
    tests:
    - dbt_utils.unique_combination_of_columns:
        combination_of_columns:
        - primarykey_id
        - episodes_id
    - dbt_expectations.expect_table_row_count_to_be_between:
        min_value: 1
    columns:
      - name: primarykey_id
        data_type: number
        description: "The unique primary key of the parent record in the [spell] table used to link to records in the child tables. This is based on the [system.record.identifier] which is the same value asthe [Generated Record ID] from the monthly SUS release."

      - name: sk_patient_id
        data_type: varchar
        description: "The pseudo NHS Number of the patient the record refers to"

      - name: episodes_id
        data_type: number
        description: "Used in combination with the [PRIMARYKEY_ID] to uniquely identify the row in the child table"

      - name: admission_source
        data_type: varchar
        description: "A code that represents the type of premises the patient was admitted from. The values to be submitted should be two digit codes. Dictionary in: "

      - name: discharge_destination
        data_type: varchar
        description: "discharge.destinationA code that indicates the type of premises that a patient is discharged to, this is only mandatory on the last episode in a spell so may be null. The values to be submitted should be two digit codes"

      - name: start_date
        data_type: timestamp_ntz
        description: "A date that identifies when an episode within a hospital provider spell started, i.e. the date on which the patient was admitted or, if in hospital, the date the consultant responsible for care changed."

      - name: end_date
        data_type: timestamp_ntz
        description: "A date that identifies when an episode within a hospital provider spell ended, i.e. the date on which the patient was discharged or, if staying in hospital, the date the consultant responsible for care changed."

      - name: duration
        data_type: number
        description: "This is the calculated value in days resulting from the subtraction of the submitted items:"

      - name: commissioning_service_agreement_provider
        data_type: varchar
        description: "The Organisation Code of the Organisation acting as a Health Care Provider as issued by the Organisation Data Service (ODS). This field represents the organisation receiving payment for the associated activity. The value of this field is unaltered"

      - name: commissioning_service_agreement_commissioner
        data_type: varchar
        description: "The Organisation Code of the Organisation commissioning health care as issued by the Organisation Data Service (ODS) and validated against reference data. The value is the Commissioner Code reason for access to data held on user smart cards"

      - name: commissioning_grouping_core_hrg
        data_type: varchar
        description: "The core HRG derived by SUS - as a result of HRG grouping and used for tariff application."

      - name: dominant_episode_flag
        data_type: varchar
        description: An episode level field returned from the HRG grouper. It is based on grouping episodes in the spell that are not PbR excluded"

      - name: care_professional_main_specialty
        data_type: varchar
        description: "This item is the specialty in which the consultant is contracted or recognised and the code identifies a specialty as designated by Royal Colleges."

      - name: care_professional_treatment_function
        data_type: varchar
        description: "Treatment Function Code is based on Main Specialty but also includes approved sub-specialties and treatment specialties that denote further specialisation."

      - name: care_professional_local_sub_specialty
        data_type: varchar
        description: "A unique identifier for a Consultants Local Sub-Specialty"

      - name: clinical_coding_grouper_derived_dominant_procedure
        data_type: varchar
        description: "This is the procedure submitted on the episode with the highest hierarchy rank as determined in the HRG process. Where procedures carry an equal rank then the first of these recorded on the episode will be used."

      - name: commissioning_grouping_programme_budgeting_category
        data_type: varchar
        description: "The Programme Budgeting Category code is an output of the Healthcare Resource Grouper (HRG) process. PBCs are derived for each APC record by the Grouper after derivation of the episode core HRG. At spell level the Spell HRG value is used."

      - name: commissioning_tariff_calculation_excluded_from_pbr
        data_type: number
        description: "Indicates whether episode is excluded/included in Payment by Results"

      - name: commissioning_tariff_calculation_pbr_length_of_stay_critical_care_days
        data_type: number
        description: "Derived field CC Days for LOS"

      - name: commissioning_tariff_calculation_pbr_length_of_stay_palliative_care_days
        data_type: number
        description:  "Report field Length Of Stay Adjustment (Specialist Palliative Care)"

      - name: commissioning_tariff_calculation_pbr_length_of_stay_pbr_delayed_discharge_days
        data_type: number
        description: "Based on two input fields from the last episode in a spell but only if both are populated. The value 0 is used if either are missing and a floor of 0 is imposed on the result of an undisclosed calculation"

      - name: commissioning_tariff_calculation_pbr_length_of_stay_rehabilitation_days
        data_type: number
        description: "Report field Length Of Stay Adjustment (Rehabilitation)"