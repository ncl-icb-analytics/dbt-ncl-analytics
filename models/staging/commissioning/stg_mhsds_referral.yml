models:
  - name: stg_mhsds_referral
    description: MHSDS referral requests (deduplicated)
    config:
      meta:
        owner:
          name: Thomas Shallcross
    columns:
      - name: uniq_serv_req_id
        description: Primary key - unique service request identifier
        tests:
          - unique
          - not_null

      - name: person_id
        description: MHSDS person identifier

      - name: org_id_referring
        description: The ORGANISATION IDENTIFIER of the Organisation from which the referral is made, such as a GP Practice, NHS Trust or NHS Foundation Trust.

      - name: prim_reason_referral_mh
        description: The primary presenting condition or symptom for which the patient was referred to a Mental Health Service
      
      - name: decision_to_treat_date
        description: The date that it was first identified that the patient needs mental health treatment, but the formal service request has not yet been created. However, the patient may be formally under the care of the Home Treatment Service. This applies to home treatments.

      - name: referral_request_received_date
        description: This is the date the REFERRAL REQUEST was received by the Health Care Provider.

      - name: referring_care_professional_type
        description: The type of Care Professional who referred the patient to the Mental Health Service. This data item is not required where the referrer is not a care professional e.g. self-referral, carer or employer.

      - name: refer_rejection_date
        description: The date the Referral Request to a Health Care Provider's Service was rejected by the Health Care Provider's Service. The overarching referral may remain open if another service or team involved in the same referral is still actively treating the patient.

      - name: refer_reject_reason
        description: The reason that a Referral Request has been rejected by the SERVICE.
      
      - name: refer_clos_reason
        description: The reason that a Referral Request has been closed. A Referral Request can be closed as a result of a Patient being discharged from the SERVICE. Cancelled referrals such as those entered onto a system in error should not be submitted within the data set.

    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1
