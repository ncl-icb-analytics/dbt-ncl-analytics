version: 2

models:
  - name: stg_reference_bnf_polypharmacy_exclusions
    description: |
      BNF chapter and subchapter exclusions for polypharmacy calculation.

      Defines which BNF codes should be excluded from polypharmacy medication counts.
      Uses hierarchical approach where subchapter-level rules (4-digit) override
      chapter-level rules (2-digit).

      Source: Meds Ops team specification (2025-10-27)
      Reference: GitHub issue #158

    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 40
          max_value: 100

    columns:
      - name: bnf_chapter_code
        description: |
          BNF chapter or subchapter code (2-4 characters).
          Examples: "01" (chapter), "05.03.01" (subchapter)
        tests:
          - not_null
          - unique

      - name: chapter_name
        description: Human-readable name of the BNF chapter or subchapter
        tests:
          - not_null

      - name: is_excluded
        description: |
          TRUE to exclude from polypharmacy, FALSE to explicitly include.
          FALSE values are used to override chapter-level exclusions
          (e.g., include 5.3.1 HIV even though chapter 5 is mostly excluded)
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
