version: 2
models:
  - name: dq_multiple_current_registrations
    description: 'Patient registration data quality issues where individuals have
      multiple current practice registrations.

      Registration Rules:

      • Each person should have only one current active registration

      • Multiple current registrations indicate data quality issues

      • Overlapping registration periods require resolution

      Purpose: Supports patient registration data validation and duplicate resolution
      processes.'
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - person_id
            - sk_patient_id
            - practice_id
    config:
      meta:
        owner:
          name: EddieDavison92
    columns:
      - name: person_id
        description: Unique person identifier with multiple registrations

      - name: practice_id
        description: Practice identifier for this registration

      - name: practice_name
        description: Practice name for this registration

      - name: registration_start_date
        description: Start date of this registration

      - name: registration_end_date
        description: End date of this registration (NULL for current)

      - name: registration_status
        description: Status of this registration

      - name: is_current_registration
        description: Whether this is flagged as current registration

      - name: current_registration_count
        description: Total number of current registrations for this person

      - name: overlap_severity
        description: Severity score for registration overlaps

      - name: data_quality_issue_type
        description: Type of registration data quality issue identified
