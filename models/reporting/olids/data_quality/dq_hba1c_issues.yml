models:
  - name: dq_hba1c_issues
    description: 'Data quality issues in HbA1c measurements across dual measurement scales.

      Scale Standards:

      • IFCC scale: 10-200 mmol/mol (modern international standard)

      • DCCT scale: 3-20% (legacy US standard)

      • Scale ambiguity detection for values that could be either scale

      Purpose: Supports HbA1c data validation and scale standardisation for diabetes monitoring.'
    
    columns:
      - name: person_id
        description: Unique person identifier
        
      - name: id
        description: Observation record identifier
        
      - name: clinical_effective_date
        description: Date of HbA1c measurement
        
      - name: hba1c_value
        description: HbA1c measurement value
        
      - name: result_unit_display
        description: Unit of measurement (%, mmol/mol, or derived)
        
      - name: concept_code
        description: Concept code for HbA1c measurement
        
      - name: concept_display
        description: Concept display name
        
      - name: source_cluster_id
        description: Source cluster identifier (IFCC or DCCT)
        
      - name: is_hba1c_out_of_range
        description: Whether HbA1c is outside valid range for detected scale
        
      - name: is_date_missing
        description: Whether clinical effective date is missing
        
      - name: is_future_date
        description: Whether measurement date is in the future
        
      - name: is_scale_ambiguous
        description: Whether measurement scale cannot be determined
        
      - name: is_extreme_outlier
        description: Whether HbA1c is an extreme outlier requiring validation
    
    tests:
      - cluster_ids_exist:
          cluster_ids: IFCCHBAM_COD, DCCTHBA1C_COD
