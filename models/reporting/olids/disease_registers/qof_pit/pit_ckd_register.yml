version: 2

models:
  - name: pit_ckd_register
    description: >
      CKD register calculated as of reference date {{ var('qof_reference_date') }}.
      QOF v50: Stage 3-5 diagnosis, excluding downstaged (Stage 1-2) and resolved patients.
      Override with: dbt build --vars '{"qof_reference_date": "YYYY-MM-DD"}'
    config:
      meta:
        owner:
          name: Eddie Davison
    tests:
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1

    columns:
      - name: person_id
        description: Person identifier
        tests:
          - unique
          - not_null
      - name: register_name
        description: Register name (CKD)
      - name: is_on_register
        description: Whether person qualifies for register at reference date
      - name: reference_date
        description: Date at which register status was calculated
