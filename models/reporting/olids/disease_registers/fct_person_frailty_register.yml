version: 2
models:
  - name: fct_person_frailty_register
    description: 'Frailty register for patients with frailty diagnosis tracking latest severity levels.

      One row per person with FRAILTY_DX present including severity classification (mild, moderate, severe).'

    tests:
      - dbt_utils.at_least_one:
          column_name: person_id

    config:
      meta:
        indicator:
          id: "FRAILTY"
          type: "CONDITION"
          category: "LTC"
          clinical_domain: "Geriatric"
          name_short: "Frailty"
          description_short: "Frailty register with severity stratification (non-QOF)"
          description_long: >
            Frailty register for persons with any frailty diagnosis. Includes severity 
            classification (mild, moderate, severe, unknown) based on specific frailty 
            codes. No age restrictions applied, though frailty is more common in elderly. 
            No resolution codes as frailty status can fluctuate over time. Latest severity 
            assessment takes precedence. Used for comprehensive geriatric assessment, 
            falls prevention, medication review, and care coordination. Uses FRAILTY_DX 
            cluster codes for all frailty severity levels.
          is_qof: false
          source_column: "is_on_register"
          sort_order: "COND_GERIAT_FRAILTY"
          usage_contexts:
            - "POPULATION_HEALTH_NEEDS_DASHBOARD"
          code_clusters:
            - cluster_id: "FRAILTY_DX"
              category: "INCLUSION"

    columns:
      - name: person_id
        description: Unique identifier for the person
        tests:
          - unique
          - not_null