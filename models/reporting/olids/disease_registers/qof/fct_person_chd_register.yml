version: 2
models:
  - name: fct_person_chd_register
    description: 'QOF coronary heart disease register for patients with CHD diagnosis.

      One row per person with CHD_COD present (includes MI, angina, coronary atherosclerosis).'

    tests:
      - dbt_utils.at_least_one:
          column_name: person_id

    columns:
      - name: person_id
        description: Unique identifier for the person
        tests:
          - unique
          - not_null

    config:
      meta:
        indicator:
          id: "CHD003"
          type: "CONDITION"
          category: "LTC"
          clinical_domain: "Cardiovascular"
          name_short: "Coronary Heart Disease"
          description_short: "QOF coronary heart disease register"
          description_long: >
            Coronary heart disease diagnosed using QOF criteria: Any CHD diagnosis code 
            qualifies for register inclusion. CHD is considered a permanent condition with 
            no resolution codes. Includes MI, angina, and coronary atherosclerosis. Used 
            for secondary prevention medication monitoring and cardiovascular risk 
            management. Maps to QOF indicator CHD003 (CHD Register). Uses CHD_COD for 
            diagnosis codes.
          is_qof: true
          qof_indicator: "CHD003"
          source_column: "is_on_register"
          usage_contexts:
            - "POPULATION_HEALTH_NEEDS_DASHBOARD"
            - "QOF"
          code_clusters:
            - cluster_id: "CHD_COD"
              category: "INCLUSION"
