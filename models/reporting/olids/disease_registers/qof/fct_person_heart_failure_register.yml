models:
  - name: fct_person_heart_failure_register
    description: 'QOF heart failure register for patients with active heart failure diagnosis.

      One row per person with latest HF_COD > latest HFRES_COD or no resolution, including subtype classification (General HF vs HF with LVSD/Reduced EF).'

    tests:
      - dbt_utils.at_least_one:
          column_name: person_id

    columns:
      - name: person_id
        description: Unique identifier for the person
        tests:
          - unique
          - not_null

    config:
      meta:
        indicator:
          id: "HF001"
          type: "CONDITION"
          category: "LTC"
          clinical_domain: "Cardiovascular"
          name_short: "Heart Failure"
          description_short: "QOF heart failure register"
          description_long: >
            Heart failure diagnosed using QOF criteria: Active heart failure diagnosis where 
            latest HF code is more recent than any resolution code, or no resolution recorded. 
            Includes subtype classification for General HF versus HF with LVSD/Reduced EF. Used 
            for cardiovascular quality monitoring and medication management. Maps to QOF indicator 
            HF001 (Heart Failure Register). Uses HF_COD for diagnosis codes and HFRES_COD for 
            resolution codes.
          is_qof: true
          qof_indicator: "HF001"
          source_column: "is_on_register"
          usage_contexts:
            - "POPULATION_HEALTH_NEEDS_DASHBOARD"
            - "QOF"
          code_clusters:
            - cluster_id: "HF_COD"
              category: "INCLUSION"
            - cluster_id: "HFRES_COD"
              category: "RESOLUTION"
