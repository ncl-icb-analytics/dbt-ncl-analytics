version: 2

models:
  - name: fct_person_alcohol_status
    description: 'Combined alcohol risk assessment from screening and diagnoses.

      One row per person with any alcohol-related data, integrating AUDIT/AUDIT-C scores with alcohol disorder diagnoses using 12-month recency window for conflict resolution.'
    
    config:
      meta:
        indicator:
          id: "BRF_ALCOHOL_STATUS"
          type: "RISK_FACTOR"
          category: "BEHAVIOURAL_RISK_FACTOR"
          clinical_domain: "Lifestyle"
          name_short: "Alcohol Status"
          description_short: "Population alcohol status combining AUDIT screening and clinical diagnoses"
          description_long: >
            Population alcohol status combining AUDIT/AUDIT-C screening scores with
            clinical diagnoses of alcohol misuse disorders. Includes non-drinkers through
            to alcohol dependence, integrating screening tools and formal diagnoses.
            Uses AUDIT thresholds alongside disorder diagnoses with 12-month recency window
            for conflict resolution. Supports population health monitoring, intervention
            planning, and clinical care pathways.
          is_qof: false
          source_column: "alcohol_status"
          sort_order: "BRF_3_ALCOHOL_STATUS"
          usage_contexts:
            - "POPULATION_HEALTH_NEEDS_DASHBOARD"
          code_clusters:
            - cluster_id: "ALCOHOL_AUDIT_COD"
              category: "INCLUSION"
            - cluster_id: "ALCOHOL_DISORDER_COD" 
              category: "INCLUSION"
          thresholds:
            # AUDIT-C Risk Categories
            - population_group: "ALL"
              threshold_type: "AUDIT_C_NON_DRINKER"
              threshold_value: "0"
              threshold_operator: "EQUALS"
              threshold_unit: "score"
              description: "AUDIT-C non-drinker"
              sort_order: 1
            - population_group: "ALL"
              threshold_type: "AUDIT_C_OCCASIONAL"
              threshold_value: "1-2"
              threshold_operator: "BETWEEN"
              threshold_unit: "score"
              description: "AUDIT-C occasional drinker"
              sort_order: 2
            - population_group: "ALL"
              threshold_type: "AUDIT_C_LOWER_RISK"
              threshold_value: "3-4"
              threshold_operator: "BETWEEN"
              threshold_unit: "score"
              description: "AUDIT-C lower risk drinking"
              sort_order: 3
            - population_group: "ALL"
              threshold_type: "AUDIT_C_INCREASING_RISK"
              threshold_value: "5-7"
              threshold_operator: "BETWEEN"
              threshold_unit: "score"
              description: "AUDIT-C increasing risk drinking"
              sort_order: 4
            - population_group: "ALL"
              threshold_type: "AUDIT_C_HIGHER_RISK"
              threshold_value: "8-10"
              threshold_operator: "BETWEEN"
              threshold_unit: "score"
              description: "AUDIT-C higher risk drinking"
              sort_order: 5
            - population_group: "ALL"
              threshold_type: "AUDIT_C_DEPENDENCE"
              threshold_value: "11-12"
              threshold_operator: "BETWEEN"
              threshold_unit: "score"
              description: "AUDIT-C possible dependence"
              sort_order: 6
            # Full AUDIT Risk Categories
            - population_group: "ALL"
              threshold_type: "AUDIT_NON_DRINKER"
              threshold_value: "0"
              threshold_operator: "EQUALS"
              threshold_unit: "score"
              description: "Full AUDIT non-drinker"
              sort_order: 7
            - population_group: "ALL"
              threshold_type: "AUDIT_OCCASIONAL"
              threshold_value: "1-3"
              threshold_operator: "BETWEEN"
              threshold_unit: "score"
              description: "Full AUDIT occasional drinker"
              sort_order: 8
            - population_group: "ALL"
              threshold_type: "AUDIT_LOWER_RISK"
              threshold_value: "4-7"
              threshold_operator: "BETWEEN"
              threshold_unit: "score"
              description: "Full AUDIT lower risk drinking"
              sort_order: 9
            - population_group: "ALL"
              threshold_type: "AUDIT_INCREASING_RISK"
              threshold_value: "8-15"
              threshold_operator: "BETWEEN"
              threshold_unit: "score"
              description: "Full AUDIT increasing risk drinking"
              sort_order: 10
            - population_group: "ALL"
              threshold_type: "AUDIT_HIGHER_RISK"
              threshold_value: "16-19"
              threshold_operator: "BETWEEN"
              threshold_unit: "score"
              description: "Full AUDIT higher risk drinking"
              sort_order: 11
            - population_group: "ALL"
              threshold_type: "AUDIT_DEPENDENCE"
              threshold_value: "20+"
              threshold_operator: "AT_OR_ABOVE"
              threshold_unit: "score"
              description: "Full AUDIT possible dependence"
              sort_order: 12
            # Clinical Intervention Thresholds
            - population_group: "ALL"
              threshold_type: "BRIEF_INTERVENTION_AUDIT_C"
              threshold_value: "5"
              threshold_operator: "AT_OR_ABOVE"
              threshold_unit: "score"
              description: "AUDIT-C brief intervention threshold"
              sort_order: 13
            - population_group: "ALL"
              threshold_type: "BRIEF_INTERVENTION_AUDIT"
              threshold_value: "8"
              threshold_operator: "AT_OR_ABOVE"
              threshold_unit: "score"
              description: "Full AUDIT brief intervention threshold"
              sort_order: 14
            - population_group: "ALL"
              threshold_type: "SPECIALIST_REFERRAL_AUDIT_C"
              threshold_value: "8"
              threshold_operator: "AT_OR_ABOVE"
              threshold_unit: "score"
              description: "AUDIT-C specialist intervention threshold"
              sort_order: 15
            - population_group: "ALL"
              threshold_type: "SPECIALIST_REFERRAL_AUDIT"
              threshold_value: "16"
              threshold_operator: "AT_OR_ABOVE"
              threshold_unit: "score"
              description: "Full AUDIT specialist intervention threshold"
              sort_order: 16

    columns:
      - name: person_id
        description: Unique identifier for the person
        tests:
          - not_null
          - unique

      - name: latest_assessment_date
        description: Most recent date of any alcohol assessment (AUDIT or disorder diagnosis)

      - name: alcohol_status
        description: Combined alcohol status considering both AUDIT scores and disorder diagnoses

      - name: alcohol_risk_sort_key
        description: Numeric sort key for ordering from lowest (1) to highest (6) risk, with historical disorders as (7)

      - name: audit_score
        description: Most recent AUDIT or AUDIT-C score

      - name: audit_type
        description: Type of most recent AUDIT assessment (AUDIT-C or Full AUDIT)

      - name: audit_risk_category
        description: Risk category from most recent AUDIT assessment

      - name: has_dependence_diagnosis
        description: Flag indicating any alcohol dependence diagnosis in history

      - name: has_harmful_use_diagnosis
        description: Flag indicating harmful or hazardous use diagnosis

      - name: has_active_disorder
        description: Flag for currently active alcohol disorder

      - name: has_remission_record
        description: Flag indicating remission status recorded

      - name: requires_intervention
        description: Flag for persons requiring clinical intervention

      - name: conflicting_assessment_flag
        description: Flag for conflicting AUDIT and disorder assessments requiring review

      - name: brief_intervention_indicated
        description: Flag indicating brief intervention threshold met

      - name: audit_data_recency
        description: Recency classification of AUDIT data (Current, Recent, Historical, No AUDIT)

      - name: disorder_data_recency
        description: Recency classification of disorder data (Current, Recent, Historical, No Disorder Record)