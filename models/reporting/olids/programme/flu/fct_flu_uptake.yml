version: 2

models:
  - name: fct_flu_uptake
    description: 'Flu vaccination uptake fact table focused on core uptake metrics.

      Grain: One row per person per campaign per risk group they qualify for

      Contains: • Eligibility status and reasons • Vaccination status (vaccinated,
      declined, no record) • Uptake category and timing metrics • Campaign reference
      dates • LAIV administration tracking

      Purpose: Core uptake facts for flu programme monitoring. Join with dim_person_demographics
      for demographic analysis.'
    config:
      meta:
        indicator:
          id: "FLU_UPTAKE_COVERAGE"
          type: "PROGRAMME"
          category: "FLU"
          clinical_domain: "Programme Management"
          name_short: "Flu Uptake Coverage"
          description_short: "Flu vaccination uptake facts without demographics"
          description_long: >
            Flu vaccination uptake fact table combining eligibility determination
            with vaccination status to provide core uptake metrics including LAIV
            tracking.
            Focused on uptake business process without demographics. Supports programme
            monitoring
            and performance assessment. Join with dim_person_demographics for demographic
            analysis
            and published_reporting_direct_care.covid_flu_dashboard_base for dashboard
            consumption.
          is_qof: false
          source_column: "uptake_rate"
          sort_order: "FLU_102_UPTAKE_COVERAGE"
          usage_contexts:
            - "COVID_AND_FLU_DASHBOARD"
            - "FLU_REPORTING"
          code_clusters:
            - cluster_id: "FLUVAX_COD"
              category: "INCLUSION"
            - cluster_id: "FLURX_COD"
              category: "INCLUSION"
          thresholds:
            - population_group: "NATIONAL_TARGET"
              threshold_type: "COVERAGE_RATE"
              threshold_value: "75"
              threshold_operator: "TARGET"
              threshold_unit: "percentage"
              description: "National flu vaccination coverage target"
              sort_order: 1
            - population_group: "HIGH_RISK_GROUPS"
              threshold_type: "COVERAGE_RATE"
              threshold_value: "85"
              threshold_operator: "TARGET"
              threshold_unit: "percentage"
              description: "High-risk group coverage target"
              sort_order: 2

        owner:
          name: EddieDavison92
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - campaign_id
            - person_id
            - risk_group
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1

    columns:
      - name: campaign_id
        description: Flu campaign identifier
        tests:
          - not_null

      - name: person_id
        description: Unique person identifier
        tests:
          - not_null

      - name: campaign_year
        description: Flu campaign year

      - name: geography_type
        description: Geographic aggregation level (practice, PCN, borough)

      - name: geography_code
        description: Geographic area identifier

      - name: geography_name
        description: Geographic area name

      - name: demographic_group
        description: Demographic grouping (age band, ethnicity, etc.)

      - name: eligible_population
        description: Total eligible population

      - name: vaccinated_population
        description: Total vaccinated population

      - name: uptake_rate
        description: Vaccination coverage percentage

      - name: unvaccinated_population
        description: Eligible but unvaccinated population
