version: 2

models:
  - name: fct_flu_status
    description: 'Flu vaccination status combining eligibility with vaccination records.

      Grain: One row per person per campaign per status event (vaccination given,
      LAIV given, declined, or eligible with no record)

      Contains: • Eligibility determination and risk group classification • Vaccination
      status (given, LAIV given, declined, no record) • Status dates and reasoning
      • Eligibility flags and timing

      Note: Includes both TIV and LAIV vaccination tracking'
    config:
      meta:
        indicator:
          id: "FLU_STATUS_TRACKING"
          type: "PROGRAMME"
          category: "FLU"
          clinical_domain: "Programme Management"
          name_short: "Flu Status Tracking"
          description_short: "Flu vaccination status combining eligibility and vaccination
            records"
          description_long: >
            Flu vaccination status tracking combining eligibility determination
            with vaccination records to create status categories: eligible and vaccinated,
            eligible but not vaccinated, not eligible, and vaccination outside campaign
            period.
            Supports vaccination monitoring, coverage reporting, and identification
            of unvaccinated
            eligible patients for targeted interventions.
          is_qof: false
          source_column: "vaccination_status"
          sort_order: "FLU_101_STATUS_TRACKING"
          usage_contexts:
            - "COVID_AND_FLU_DASHBOARD"
            - "FLU_REPORTING"
          code_clusters:
            - cluster_id: "FLUVAX_COD"
              category: "INCLUSION"
            - cluster_id: "FLURX_COD"
              category: "INCLUSION"
            - cluster_id: "DECL_COD"
              category: "REFINEMENT"
            - cluster_id: "NOCONS_COD"
              category: "REFINEMENT"
          thresholds:
            - population_group: "CAMPAIGN"
              threshold_type: "DATE_RANGE"
              threshold_value: "campaign_date_range"
              threshold_operator: "BETWEEN"
              threshold_unit: "dates"
              description: "Campaign period for vaccination timing"
              sort_order: 1

        owner:
          name: EddieDavison92
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - campaign_id
            - person_id
            - status_type
      - dbt_expectations.expect_table_row_count_to_be_between:
          min_value: 1

    columns:
      - name: person_id
        description: Unique person identifier
        tests:
          - not_null

      - name: campaign_id
        description: Flu campaign identifier
        tests:
          - not_null

      - name: campaign_year
        description: Campaign year

      - name: is_eligible
        description: Whether person is eligible for vaccination

      - name: is_vaccinated
        description: Whether person received flu vaccination

      - name: vaccination_date
        description: Date of flu vaccination (if vaccinated)

      - name: vaccination_status
        description: Combined eligibility and vaccination status

      - name: eligibility_category
        description: Category for eligibility (age, clinical, etc.)

      - name: vaccination_in_campaign_period
        description: Whether vaccination occurred within campaign period

      - name: days_to_vaccination
        description: Days from campaign start to vaccination
