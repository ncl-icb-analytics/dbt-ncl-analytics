version: 2

models:
  - name: fct_person_wl_current_count_total
    description: >
      Count of open waiting lists per person (patient_id), count of distinct TFC open waiting lists per person, count of distinct provider open waiting lists per person.
      Derived from `int_wl_current`.
    config:
      materialized: view
    columns:
      - name: sk_patient_id
        description: Unique identifier for each patient.
        tests:
          - not_null
          - unique
      - name: wl_current_total_count
        description: Total number of open waiting lists for the patient.

      - name: wl_current_distinct_providers_count
        description: Number of distinct providers that the patient has open waiting lists on.

      - name: wl_current_distinct_tfc_count
        description: Number of distinct Treatment Function Codes (TFCs) that the patient has open waiting lists on.

      - name: same_tfc_multiple_providers_flag
        description: >
          Boolean flag indicating whether the patient has the same TFC code
          assigned to multiple providers.
    tests:
    - dbt_expectations.expect_table_row_count_to_be_between:
        min_value: 1