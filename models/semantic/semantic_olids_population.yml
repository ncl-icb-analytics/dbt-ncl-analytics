version: 2

models:
  - name: semantic_olids_population
    description: |
      OLIDS Population Health Semantic View
      ======================================
      
      Comprehensive semantic model for NCL population health analysis combining
      demographics, conditions, and smoking status into a unified semantic layer.
      
      **Purpose:**
      - Enable natural language queries via Snowflake Cortex Analyst
      - Provide governed metric definitions for population health reporting
      - Support self-service analytics without requiring knowledge of table joins
      
      **Grain:** One row per person (current state)
      
      **Tables Included:**
      - `dim_person_demographics`: Core demographics, registration, geography
      - `dim_person_conditions`: Boolean flags for all conditions + summary counts
      - `fct_person_smoking_status`: Smoking status (LEFT JOIN)
      
      **Example Queries:**
      
      ```sql
      -- Get diabetes prevalence by borough
      SELECT *
      FROM SEMANTIC_VIEW(
        ANALYTICS_DEV.SEMANTIC.SEMANTIC_OLIDS_POPULATION
        METRICS diabetes_count, patient_count
        DIMENSIONS borough_registered
      )
      
      -- Average conditions by deprivation
      SELECT *
      FROM SEMANTIC_VIEW(
        ANALYTICS_DEV.SEMANTIC.SEMANTIC_OLIDS_POPULATION
        METRICS avg_conditions_per_patient, patient_count
        DIMENSIONS imd_quintile_25
      )
      
      -- Smoking status by age band
      SELECT *
      FROM SEMANTIC_VIEW(
        ANALYTICS_DEV.SEMANTIC.SEMANTIC_OLIDS_POPULATION
        METRICS current_smoker_count, ex_smoker_count
        DIMENSIONS age_band_10y
        WHERE is_active = TRUE
      )
      ```
      
      **Limitations:**
      - Person status tables (care_home, homeless, carer) excluded as they only
        contain rows for people WITH that status
      - Consider separate semantic views for vulnerability-focused analysis

    config:
      materialized: semantic_view
      schema: SEMANTIC
      meta:
        owner:
          name: EddieDavison92
