version: 2
models:
  - name: dim_practice
    description: 'Practice dimension with organisational hierarchy spanning multiple London ICBs.

      Key Features:

      • One row per practice combining Dictionary and OLIDS data sources

      • Borough-prefixed PCN names for geographic clarity

      • Practice name cleaning via clean_practice_name macro for consistency

      • Geographic coordinates and LSOA/MSOA mapping for spatial analysis

      • Complete organisational hierarchy (Practice > PCN > Commissioner > STP)

      • Filtered to London ICBs: North Central, North East, North West, South East, South West

      Purpose: Supports practice-level reporting, geographic analysis, and organisational hierarchy navigation.'

    columns:
      - name: organisation_id
        description: 'OLIDS internal organisation ID for practice'
        tests:
          - not_null
          - unique

      - name: practice_code
        description: 'Practice ODS code (NHS organisational code)'
        tests:
          - not_null

      - name: practice_name
        description: 'Practice name cleaned and standardised via macro'
        tests:
          - not_null

      - name: pcn_code
        description: 'Primary Care Network code this practice belongs to'

      - name: pcn_name
        description: 'Primary Care Network name'

      - name: pcn_name_with_borough
        description: 'PCN name prefixed with borough for geographic identification'

      - name: borough_registered
        description: 'Borough where practice is located'

      - name: pcn_borough
        description: 'Borough where practices PCN is located (may differ from practice borough)'

      - name: practice_historic_ccg
        description: 'Historic CCG association for temporal analysis'

      - name: practice_type_code
        description: 'OLIDS practice type code (e.g., GP surgery, health centre)'

      - name: practice_type_desc
        description: 'OLIDS practice type description'

      - name: practice_postcode
        description: 'Practice postcode from OLIDS'

      - name: practice_open_date
        description: 'Practice opening date from OLIDS'

      - name: practice_close_date
        description: 'Practice closure date from OLIDS (NULL if still open)'

      - name: practice_is_obsolete
        description: 'OLIDS flag indicating if practice record is obsolete'
        tests:
          - not_null

      - name: practice_parent_organisation_id
        description: 'OLIDS parent organisation ID for practice'

      - name: practice_start_date
        description: 'Practice start date from Dictionary'

      - name: practice_end_date
        description: 'Practice end date from Dictionary (NULL if still active)'

      - name: practice_address_line_1
        description: 'Practice address line 1 from Dictionary'

      - name: practice_address_line_2
        description: 'Practice address line 2 from Dictionary'

      - name: practice_address_line_3
        description: 'Practice address line 3 from Dictionary'

      - name: practice_address_line_4
        description: 'Practice address line 4 from Dictionary'

      - name: practice_address_line_5
        description: 'Practice address line 5 from Dictionary'

      - name: practice_first_created
        description: 'Timestamp when practice record first created in Dictionary'

      - name: practice_last_updated
        description: 'Timestamp when practice record last updated in Dictionary'

      - name: practice_postcode_dict
        description: 'Practice postcode from Dictionary (standardised format)'

      - name: practice_lsoa
        description: 'Lower Layer Super Output Area for practice location'

      - name: practice_msoa
        description: 'Middle Layer Super Output Area for practice location'

      - name: practice_latitude
        description: 'Practice latitude coordinate for mapping'

      - name: practice_longitude
        description: 'Practice longitude coordinate for mapping'

      - name: commissioner_code
        description: 'Commissioner code (typically CCG/ICB)'

      - name: commissioner_name
        description: 'Commissioner name'

      - name: sk_commissioner_id
        description: 'Surrogate key for commissioner organisation'

      - name: stp_code
        description: 'STP/ICB code (London ICBs: QMJ, QMF, QRV, QWE, QKK)'
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['QMJ', 'QMF', 'QRV', 'QWE', 'QKK']

      - name: stp_name
        description: 'STP/ICB name (London Integrated Care Boards)'
        tests:
          - not_null

      - name: sk_stp_id
        description: 'Surrogate key for STP organisation'

      - name: sk_practice_id
        description: 'Dictionary surrogate key for practice'

      - name: sk_practice_dict_id
        description: 'Dictionary organisation surrogate key for practice'
