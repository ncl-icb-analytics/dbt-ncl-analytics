models:
  - name: fct_person_diabetes_register
    description: 'QOF diabetes register with type classification for patients aged 17+ with active diabetes.

      QOF Criteria:

      • Age ≥17 years

      • Active diabetes diagnosis (DM_COD codes)

      • Latest diabetes code more recent than latest resolution code

      • Type classification: Type 1, Type 2, or Unknown (Type 1 takes precedence)

      Purpose: Supports QOF reporting and diabetes care management with accurate type classification for treatment planning.'
    
    config:
      meta:
        indicator:
          id: "DM017"
          type: "CONDITION"
          category: "LTC"
          clinical_domain: "Cardiometabolic"
          name_short: "Diabetes"
          description_short: "QOF diabetes register (all types)"
          description_long: >
            Diabetes mellitus diagnosed using QOF criteria: Age ≥17 years with active 
            diagnosis where latest diabetes code is more recent than any resolution code. 
            Includes all diabetes types - Type 1, Type 2, and unspecified diabetes codes.
            Type classification prioritises Type 1 over Type 2 when both present on same date.
            Maps to QOF indicator DM017 (Diabetes Register). Uses DM_COD (general), 
            DMTYPE1_COD (Type 1), and DMTYPE2_COD (Type 2) cluster codes.
          is_qof: true
          qof_indicator: "DM017"
          source_column: "is_on_register"
          usage_contexts:
            - "POPULATION_HEALTH_NEEDS_DASHBOARD"
            - "QOF"
          code_clusters:
            - cluster_id: "DM_COD"
              category: "INCLUSION"
            - cluster_id: "DMTYPE1_COD"
              category: "INCLUSION"
            - cluster_id: "DMTYPE2_COD"
              category: "INCLUSION"
            - cluster_id: "DMRES_COD"
              category: "RESOLUTION"
    
    columns:
      - name: person_id
        description: Unique person identifier
        
      - name: is_on_register
        description: Whether person meets QOF diabetes register criteria
        
      - name: age
        description: Person's current age
        
      - name: diabetes_type
        description: Diabetes type classification (Type 1, Type 2, Unknown)
        
      - name: earliest_diagnosis_date
        description: Date of earliest diabetes diagnosis
        
      - name: latest_diagnosis_date
        description: Date of most recent diabetes diagnosis
        
      - name: earliest_type1_date
        description: Date of earliest Type 1 diabetes diagnosis
        
      - name: latest_type1_date
        description: Date of most recent Type 1 diabetes diagnosis
        
      - name: earliest_type2_date
        description: Date of earliest Type 2 diabetes diagnosis
        
      - name: latest_type2_date
        description: Date of most recent Type 2 diabetes diagnosis
        
      - name: latest_resolved_date
        description: Date of most recent diabetes resolution code
        
      - name: is_type1_diabetes
        description: Whether classified as Type 1 diabetes
        
      - name: is_type2_diabetes
        description: Whether classified as Type 2 diabetes
        
      - name: all_diabetes_concept_codes
        description: All diabetes concept codes for this person
        
      - name: all_diabetes_concept_displays
        description: All diabetes concept display names for this person
