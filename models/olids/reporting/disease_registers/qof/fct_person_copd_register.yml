version: 2
models:
  - name: fct_person_copd_register
    description: 'QOF COPD register with date-based inclusion rules and spirometry confirmation.

      One row per person with unresolved COPD diagnosis, requiring spirometry confirmation (FEV1/FVC < 0.7) for diagnoses after 01/04/2023.'
    
    config:
      meta:
        indicator:
          id: "COPD007"
          type: "CONDITION"
          category: "LTC"
          clinical_domain: "Respiratory"
          name_short: "COPD"
          description_short: "QOF COPD register"
          description_long: >
            COPD diagnosed using QOF criteria with date-based inclusion rules: Automatic inclusion 
            for patients with earliest unresolved diagnosis before 01/04/2023, or spirometry 
            confirmation (FEV1/FVC <0.7) within 93 days before and 186 days after earliest 
            unresolved diagnosis for post-April 2023 diagnoses. Maps to QOF indicator COPD007 
            (COPD Register). Uses COPD_COD for diagnosis codes and COPDRES_COD for resolution codes.
          is_qof: true
          qof_indicator: "COPD007"
          source_column: "is_on_register"
          usage_contexts:
            - "POPULATION_HEALTH_NEEDS_DASHBOARD"
            - "QOF"
          code_clusters:
            - cluster_id: "COPD_COD"
              category: "INCLUSION"
            - cluster_id: "COPDRES_COD"
              category: "RESOLUTION"
