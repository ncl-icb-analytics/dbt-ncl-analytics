version: 2

models:
  - name: fct_covid_flu_uptake
    description: 'Combined COVID and flu vaccination uptake facts without demographics.

      Grain: One row per person per campaign per risk group they qualify for

      Contains:
      • Programme identifier (COVID/FLU) for filtering
      • Eligibility status and reasons for each programme
      • Vaccination status (vaccinated, declined, no record)
      • Uptake category and timing metrics
      • Campaign details and dates

      Purpose: Core uptake facts for both programmes. Join with published_reporting_direct_care.covid_flu_dashboard_base for dashboard consumption with demographics.
      
      Campaigns: covid_2024_autumn, covid_2025_spring, covid_2025_autumn, flu_2023_24, flu_2024_25, flu_2025_26'
    
    config:
      meta:
        indicator:
          id: "COVID_FLU_UPTAKE_COMBINED"
          type: "PROGRAMME"
          category: "MULTI_PROGRAMME"
          clinical_domain: "Programme Management"
          name_short: "COVID and Flu Uptake Combined"
          description_short: "Combined COVID and flu vaccination uptake facts"
          description_long: >
            Combined COVID and flu vaccination uptake fact table with shared schema
            supporting cross-programme comparison, year-over-year trends, and
            programme monitoring. Focused on core uptake metrics without demographics.
            Built for efficient joining with demographics via published_reporting_direct_care.covid_flu_dashboard_base
            for dashboard consumption with programme identifiers enabling filtering and analysis.
          is_qof: false
          source_column: "uptake_category"
          sort_order: "MULTI_103_COVID_FLU_COMBINED"
          usage_contexts:
            - "COVID_REPORTING"
            - "FLU_REPORTING"
            - "COVID_AND_FLU_DASHBOARD"
          code_clusters:
            - cluster_id: "COVADM_COD"
              category: "INCLUSION"
            - cluster_id: "COVRX_COD"
              category: "INCLUSION"
            - cluster_id: "FLUVAX_COD"
              category: "INCLUSION"
            - cluster_id: "FLURX_COD"
              category: "INCLUSION"
            - cluster_id: "COVDECL_COD"
              category: "REFINEMENT"
            - cluster_id: "DECL_COD"
              category: "REFINEMENT"
          thresholds:
            - population_group: "COVID_NATIONAL_TARGET"
              threshold_type: "COVERAGE_RATE"
              threshold_value: "75"
              threshold_operator: "TARGET"
              threshold_unit: "percentage"
              description: "National COVID vaccination coverage target"
              sort_order: 1
            - population_group: "FLU_NATIONAL_TARGET"
              threshold_type: "COVERAGE_RATE"
              threshold_value: "75"
              threshold_operator: "TARGET"
              threshold_unit: "percentage"
              description: "National flu vaccination coverage target"
              sort_order: 2
            - population_group: "HIGH_RISK_GROUPS"
              threshold_type: "COVERAGE_RATE"
              threshold_value: "85"
              threshold_operator: "TARGET"
              threshold_unit: "percentage"
              description: "High-risk group coverage target (both programmes)"
              sort_order: 3
    
    columns:
      - name: programme_type
        description: Programme identifier (COVID or FLU)
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['COVID', 'FLU']
        
      - name: campaign_id
        description: Campaign identifier (programme-specific)
        tests:
          - not_null
        
      - name: campaign_year
        description: Campaign year (e.g., 2024/25, 2025/26)
        
      - name: campaign_season
        description: Campaign season (Autumn, Spring, Annual)
        
      - name: person_id
        description: Unique person identifier
        tests:
          - not_null
        
      - name: is_active
        description: Whether person is active in the system
        
      - name: sex
        description: Person's sex
        
      - name: age
        description: Person's current age
        
      - name: age_band_5y
        description: 5-year age band grouping
        
      - name: age_band_10y
        description: 10-year age band grouping
        
      - name: age_band_nhs
        description: NHS standard age band grouping
        
      - name: ethnicity_category
        description: High-level ethnicity categorisation
        
      - name: ethnicity_subcategory
        description: Detailed ethnicity subcategory
        
      - name: main_language
        description: Person's main spoken language
        
      - name: interpreter_needed
        description: Whether interpreter services are needed
        
      - name: imd_quintile_19
        description: Index of Multiple Deprivation quintile (2019)
        
      - name: imd_decile_19
        description: Index of Multiple Deprivation decile (2019)
        
      - name: lsoa_code
        description: Lower Super Output Area code
        
      - name: practice_code
        description: GP practice code
        
      - name: practice_name
        description: GP practice name
        
      - name: pcn_code
        description: Primary Care Network code
        
      - name: pcn_name
        description: Primary Care Network name
        
      - name: borough_registered
        description: Borough where practice is located
        
      - name: is_eligible
        description: Whether person is eligible for vaccination
        
      - name: campaign_category
        description: Category of eligibility
        
      - name: risk_group
        description: Specific risk group classification
        
      - name: eligibility_reason
        description: Reason for eligibility
        
      - name: rule_type
        description: Type of eligibility rule
        
      - name: vaccination_status
        description: Vaccination status
        
      - name: vaccination_date
        description: Date of vaccination (if vaccinated)
        
      - name: vaccinated
        description: Whether person received vaccination
        
      - name: declined
        description: Whether person declined vaccination
        
      - name: eligible_no_record
        description: Whether eligible person has no vaccination record
        
      - name: uptake_category
        description: Categorised uptake status
        
      - name: days_to_vaccination
        description: Days from campaign start to vaccination
        
      - name: laiv_given
        description: Whether LAIV was administered (flu only)
        
      - name: campaign_start_date
        description: Campaign start date
        
      - name: campaign_reference_date
        description: Campaign reference date for age calculations