version: 2
models:
  - name: dim_person_birth_death
    description: 'Person vital statistics with birth and death information using statistical midpoint methodology.

      Key Features:

      • One row per person with recorded birth year and month

      • Statistical midpoint approximation for birth and death dates

      • Includes both living and deceased persons

      • Selects best patient record per person (prioritising those with DOB)

      • Fallback to current registration patient for surrogate key consistency

      Purpose: Foundation for age calculations, demographic analysis, and mortality tracking.'
    
    columns:
      - name: person_id
        description: 'Unique identifier for the person'
        tests:
          - not_null
          - unique

      - name: sk_patient_id
        description: 'Surrogate key from current registration or best mapped patient'
      
      - name: birth_year
        description: 'Year of birth'
        tests:
          - not_null
      
      - name: birth_month
        description: 'Month of birth (1-12)'
        tests:
          - not_null
          - dbt_utils.accepted_range:
              arguments:
                min_value: 1
                max_value: 12
      
      - name: birth_date_approx
        description: 'Approximate birth date using statistical midpoint of birth month'
        tests:
          - not_null

      - name: death_year
        description: 'Year of death (NULL if still living)'

      - name: death_month
        description: 'Month of death (NULL if still living)'
      
      - name: death_date_approx
        description: 'Approximate death date using statistical midpoint of death month (NULL if still living)'
      
      - name: is_deceased
        description: 'Flag indicating if person is deceased'
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: [true, false]

      - name: is_dummy_patient
        description: 'Flag indicating if record comes from dummy patient data'
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: [true, false]
