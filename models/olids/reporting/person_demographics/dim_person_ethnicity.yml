version: 2
models:
  - name: dim_person_ethnicity
    description: 'Latest recorded ethnicity for all persons with three-level classification hierarchy.

      Key Features:

      • One row per person with most recent ethnicity recording

      • Three-tier classification: Category > Subcategory > Granular detail

      • Prioritisation logic: non-deprioritised records, higher specificity, then most recent

      • Defaults to "Not Recorded" for persons without ethnicity data

      • Includes sorting helpers for consistent display ordering

      Purpose: Supports ethnicity analysis, health equity monitoring, and demographic profiling.'
    
    columns:
      - name: person_id
        description: 'Unique identifier for the person'
        tests:
          - not_null
          - unique

      - name: sk_patient_id
        description: 'Surrogate key for patient record (NULL if no ethnicity recorded)'
      
      - name: latest_ethnicity_date
        description: 'Clinical effective date of latest ethnicity recording'

      - name: concept_id
        description: 'SNOMED concept ID for ethnicity ("Not Recorded" if none available)'
        tests:
          - not_null

      - name: snomed_code
        description: 'SNOMED code for ethnicity ("Not Recorded" if none available)'
        tests:
          - not_null

      - name: term
        description: 'SNOMED term description for ethnicity ("Not Recorded" if none available)'
        tests:
          - not_null
      
      - name: ethnicity_category
        description: 'Main ethnicity category (e.g., White, Asian, Black, Mixed, Other)'
        tests:
          - not_null

      - name: ethnicity_subcategory
        description: 'Ethnicity subcategory within main category'
        tests:
          - not_null

      - name: ethnicity_granular
        description: 'Most detailed ethnicity classification available'
        tests:
          - not_null

      - name: deprioritise_flag
        description: 'Flag indicating if this ethnicity record should be deprioritised in selection'

      - name: preference_rank
        description: 'Preference ranking for ethnicity record selection (lower = higher priority)'

      - name: category_sort
        description: 'Sort order for ethnicity category display'

      - name: display_sort_key
        description: 'Combined sort key for consistent ethnicity display ordering'

