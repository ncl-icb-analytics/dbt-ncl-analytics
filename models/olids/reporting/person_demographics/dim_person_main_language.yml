version: 2
models:
  - name: dim_person_main_language
    description: 'Latest recorded preferred language and interpreter needs with communication support requirements.

      Key Features:

      • One row per person with most recent language preference

      • Language extraction from preference codes (PREFLANG_COD) and interpreter requirements (REQINTERPRETER_COD)

      • Language type classification: Spoken, Sign, Other Communication Method

      • Interpreter needs analysis including specific interpreter types

      • Communication support flags for accessibility requirements

      • Defaults to "Not Recorded" for persons without language data

      Purpose: Supports accessibility planning, interpreter service allocation, and communication needs assessment.'

    columns:
      - name: person_id
        description: 'Unique identifier for the person'
        tests:
          - not_null
          - unique

      - name: sk_patient_id
        description: 'Surrogate key for patient record (NULL if no language recorded)'

      - name: latest_language_date
        description: 'Clinical effective date of latest language recording'

      - name: concept_id
        description: 'SNOMED concept ID for language preference ("Not Recorded" if none available)'
        tests:
          - not_null

      - name: concept_code
        description: 'SNOMED concept code for language preference ("Not Recorded" if none available)'
        tests:
          - not_null

      - name: term
        description: 'SNOMED term description for language preference ("Not Recorded" if none available)'
        tests:
          - not_null

      - name: language
        description: 'Clean language name extracted from clinical terms ("Not Recorded" if none available)'
        tests:
          - not_null

      - name: language_type
        description: 'Type classification: Spoken, Sign, Other Communication Method ("Not Recorded" if none available)'
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['Spoken', 'Sign', 'Other Communication Method', 'Not Recorded']

      - name: language_source
        description: 'Source of language data: PREFLANG_COD (preference) or REQINTERPRETER_COD (interpreter requirement)'

      - name: interpreter_needed
        description: 'Flag indicating if interpreter services are needed'

      - name: interpreter_type
        description: 'Specific type of interpreter required (e.g., British Sign Language, Arabic)'

      - name: communication_support_needed
        description: 'Flag indicating if additional communication support is needed (lipspeaker, note taker, etc.)'

      - name: communication_support_type
        description: 'Type of communication support needed (e.g., Lipspeaker, Note Taker, Speech to Text)'

    tests:
      - cluster_ids_exist:
          arguments:
            cluster_ids: PREFLANG_COD, REQINTERPRETER_COD
