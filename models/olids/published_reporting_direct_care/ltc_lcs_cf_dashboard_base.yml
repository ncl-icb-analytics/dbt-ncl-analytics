version: 2

models:
  - name: ltc_lcs_cf_dashboard_base
    description: 'Dashboard-ready LTC/LCS case finding data in long format with demographics and indicator metadata.

      Grain: One row per person-indicator combination (only triggered indicators)

      Contains:
      
      • Complete demographics and practice registration for each person

      • Indicator metadata including names, descriptions, and clinical domains

      • Only rows for indicators that are triggered (indicator_flag = TRUE)

      • Enriched with def_indicator metadata for human-readable descriptions

      Purpose: Long format table optimised for dashboard tools like PowerBI/Tableau with dynamic filtering and visualisation capabilities.'
    
    config:
      meta:
        indicator:
          id: "LTC_LCS_CF_DASHBOARD_BASE"
          type: "DASHBOARD"
          category: "CASE_FINDING"
          clinical_domain: "Population Health Management"
          name_short: "LTC/LCS Case Finding Dashboard Base"
          description_short: "Dashboard-ready case finding data with demographics and indicator metadata"
          description_long: >
            Dashboard-ready LTC/LCS case finding data combining all 24 case finding
            indicators with complete demographics, practice registration, and indicator
            metadata. Provides single source for case finding dashboard with demographic
            breakdowns supporting equity analysis, programme monitoring, and clinical
            outreach prioritisation. Includes human-readable descriptions for each
            indicator flag to support clinical interpretation.
          is_qof: false
          source_column: "person_id"
          sort_order: "LTC_LCS_DASHBOARD_001"
          usage_contexts:
            - "LTC_LCS_DASHBOARD"
            - "CASE_FINDING_PROGRAMME"
            - "POPULATION_HEALTH_DASHBOARD"
    
    columns:
      - name: person_id
        description: Unique person identifier
        tests:
          - not_null
        
      - name: sk_patient_id
        description: Surrogate key for patient
        
      - name: is_active
        description: Whether person is active in the system
        
      - name: sex
        description: Person's sex
        
      - name: age
        description: Person's current age
        
      - name: age_band_5y
        description: 5-year age band grouping
        
      - name: age_band_10y
        description: 10-year age band grouping
        
      - name: age_band_nhs
        description: NHS standard age band grouping
        
      - name: age_life_stage
        description: Life stage categorisation based on age
        
      - name: ethnicity_category
        description: High-level ethnicity categorisation
        
      - name: ethnicity_subcategory
        description: Detailed ethnicity subcategory
        
      - name: ethnicity_granular
        description: Most detailed ethnicity categorisation
        
      - name: main_language
        description: Person's main spoken language
        
      - name: language_type
        description: Type/category of language spoken
        
      - name: interpreter_needed
        description: Whether interpreter services are needed
        
      - name: interpreter_type
        description: Type of interpreter services needed
        
      - name: imd_quintile_19
        description: Index of Multiple Deprivation quintile (2019)
        
      - name: imd_decile_19
        description: Index of Multiple Deprivation decile (2019)
        
      - name: imd_quintile_label
        description: Human-readable IMD quintile label
        
      - name: lsoa_code
        description: Lower Super Output Area code
        
      - name: practice_code
        description: GP practice code
        
      - name: practice_name
        description: GP practice name
        
      - name: pcn_code
        description: Primary Care Network code
        
      - name: pcn_name
        description: Primary Care Network name
        
      - name: borough_registered
        description: Borough where practice is located
        
      - name: neighbourhood_registered
        description: Neighbourhood where practice is located
        
      - name: in_any_case_finding
        description: Whether person triggers any case finding indicator
        
      - name: case_finding_count
        description: Total number of case finding indicators triggered for this person
        
      # Indicator details (long format)
      - name: indicator_id
        description: Short indicator ID for dashboard display (e.g. AF_61, CVD_65)
        tests:
          - not_null
          
      - name: indicator_category
        description: Indicator category (AF, CKD, CVD, DM, HTN, CYP_AST)
        
      - name: clinical_domain
        description: Clinical domain for the indicator
        
      - name: indicator_name
        description: Short human-readable indicator name
        
      - name: indicator_description
        description: Short clinical description of the indicator
        
      - name: indicator_description_long
        description: Detailed clinical description including criteria and thresholds
        
      - name: sort_order
        description: Sorting order for indicators within categories
        
      - name: indicator_flag
        description: Always TRUE (only triggered indicators included in long format)
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: [true]
                
      - name: created_at
        description: Timestamp when the row was created
        tests:
          - not_null
        
