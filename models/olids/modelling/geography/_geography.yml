version: 2

models:
  - name: int_geography_london_boroughs
    description: Identifies London boroughs from ICBs and local authorities with cleaned names
    columns:
      - name: icb_code
        description: ICB/Primary care organisation code
      - name: icb_name_original
        description: Original ICB/Primary care organisation name from source
      - name: icb_name_clean
        description: Cleaned ICB name with organisation code suffix removed
      - name: is_london_icb
        description: Flag indicating if ICB name contains 'London'
      - name: local_authority_code
        description: Local authority organisation code
      - name: local_authority_name_original
        description: Original local authority name from source
      - name: local_authority_name_clean
        description: Cleaned local authority name with 'London Borough of' prefix removed
      - name: is_london_borough
        description: Flag indicating if local authority is a London borough
      - name: is_london_geography
        description: Combined flag if either ICB or local authority is London-based

  - name: int_geography_mappings
    description: Single source of truth for geography code-to-name mappings
    columns:
      - name: mapping_category
        description: Category of mapping (ORGANISATION, GEOGRAPHY, GEOGRAPHY_MAPPING)
      - name: mapping_type
        description: Type of mapping (PRIMARY_CARE, LOCAL_AUTHORITY, LSOA_2021, etc.)
      - name: code
        description: Geographic or organisation code
      - name: name
        description: Geographic or organisation name
      - name: start_date
        description: Start date for organisation records
      - name: end_date
        description: End date for organisation records
      - name: parent_code
        description: Parent geography code for hierarchical mappings
      - name: parent_name
        description: Parent geography name for hierarchical mappings

  - name: int_geography_imd
    description: Index of Multiple Deprivation mappings and quintile calculations
    columns:
      - name: lsoa_code_2011
        description: LSOA 2011 census code
        tests:
          - not_null
          - unique
      - name: imd_decile_19
        description: IMD 2019 decile (1=most deprived, 10=least deprived)
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
      - name: imd_quintile_19
        description: IMD quintile text description
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['Most Deprived', 'Second Most Deprived', 'Third Most Deprived', 'Second Least Deprived', 'Least Deprived']
      - name: imd_quintile_numeric_19
        description: IMD quintile as number (1-5)
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: [1, 2, 3, 4, 5]
      - name: imd_tertile_19
        description: IMD tertile grouping
      - name: is_most_deprived_20pct
        description: Flag for areas in most deprived 20% (deciles 1-2)
        tests:
          - not_null