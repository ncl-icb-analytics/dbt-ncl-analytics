version: 2

models:
  - name: int_rockwood_latest
    description: 'Latest Rockwood Clinical Frailty Scale score per person.

      One row per person with their most recent Rockwood assessment using latest clinical_effective_date.'

    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - person_id

    columns:
      - name: person_id
        description: Unique identifier for the person
        tests:
          - not_null
          - unique

      - name: id
        description: Identifier for the most recent Rockwood observation
        tests:
          - not_null

      - name: clinical_effective_date
        description: Date of the most recent Rockwood assessment
        tests:
          - not_null

      - name: concept_code
        description: SNOMED CT concept code for the latest Rockwood score

      - name: concept_display
        description: Human readable description of the latest Rockwood score

      - name: source_cluster_id
        description: Source cluster identifier (ROCKWOOD_SCORES)

      - name: rockwood_score
        description: Most recent numeric Rockwood Clinical Frailty Scale score (1-9)

      - name: rockwood_description
        description: Clinical description of the latest Rockwood score level

      - name: frailty_level
        description: Latest specific Rockwood frailty level (Level 1-9 with description)

      - name: frailty_category
        description: Latest grouped frailty category (Fit, Vulnerable, Mild Frailty, Moderate Frailty, Severe Frailty)

      - name: is_valid_rockwood_code
        description: Flag indicating if concept code is a valid Rockwood score

      - name: is_frail
        description: Flag indicating current frailty status (score 5+)

      - name: is_severely_frail
        description: Flag indicating current severe frailty status (score 7+)