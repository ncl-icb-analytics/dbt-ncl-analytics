version: 2

models:
  - name: int_rockwood_all
    description: 'Rockwood Clinical Frailty Scale assessments with clinical categorisation.

      One row per Rockwood observation using ROCKWOOD_SCORES cluster with scores 1-9 mapped to frailty categories.'

    tests:
      - cluster_ids_exist:
          cluster_ids: ROCKWOOD_SCORES
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - id
            - source_cluster_id
      - dbt_utils.expression_is_true:
          expression: "rockwood_score IS NOT NULL"
          name: all_rockwood_codes_categorised
      - dbt_utils.expression_is_true:
          expression: "frailty_category != 'Unknown'"
          name: all_observations_have_valid_category

    columns:
      - name: person_id
        description: Unique identifier for the person
        tests:
          - not_null

      - name: id
        description: Identifier for the observation
        tests:
          - not_null

      - name: clinical_effective_date
        description: Date when the Rockwood assessment was performed
        tests:
          - not_null

      - name: concept_code
        description: SNOMED CT concept code for the specific Rockwood score

      - name: concept_display
        description: Human readable description of the Rockwood score

      - name: source_cluster_id
        description: Source cluster identifier (ROCKWOOD_SCORES)

      - name: rockwood_score
        description: Numeric Rockwood Clinical Frailty Scale score (1-9)

      - name: rockwood_description
        description: Clinical description of the Rockwood score level

      - name: frailty_level
        description: Specific Rockwood frailty level (Level 1-9 with description)

      - name: frailty_category
        description: Grouped frailty categories (Fit, Vulnerable, Mild Frailty, Moderate Frailty, Severe Frailty)

      - name: is_valid_rockwood_code
        description: Flag indicating if concept code is a valid Rockwood score

      - name: is_frail
        description: Flag for frailty presence (Rockwood score 5+)

      - name: is_severely_frail
        description: Flag for severe frailty (Rockwood score 7+)