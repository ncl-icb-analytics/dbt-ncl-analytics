version: 2
models:
  - name: int_heart_failure_diagnoses_all
    description: 'Heart failure diagnosis and resolution observations for QOF register management.

      One row per observation using HF_COD, HFRES_COD, HFLVSD_COD, and REDEJCFRAC_COD clusters with ejection fraction tracking.'
    columns:
      - name: id
        description: 'Unique identifier for the clinical observation'

      - name: person_id
        description: 'Patient identifier'

      - name: clinical_effective_date
        description: 'Date when heart failure observation was clinically effective'

      - name: concept_code
        description: 'Clinical code for heart failure diagnosis or resolution'

      - name: concept_display
        description: 'Human-readable description of the clinical code'

      - name: source_cluster_id
        description: 'QOF cluster identifier (HF_COD, HFRES_COD, HFLVSD_COD, or REDEJCFRAC_COD)'

      - name: is_diagnosis_code
        description: 'Flag indicating heart failure diagnosis code (HF_COD cluster)'

      - name: is_resolved_code
        description: 'Flag indicating heart failure resolution code (HFRES_COD cluster)'

      - name: is_hf_lvsd_code
        description: 'Flag indicating heart failure with LVSD code (HFLVSD_COD cluster)'

      - name: is_reduced_ef_code
        description: 'Flag indicating reduced ejection fraction code (REDEJCFRAC_COD cluster)'

      - name: heart_failure_observation_type
        description: 'Categorised heart failure observation type (diagnosis, LVSD, reduced EF, or resolved)'

    tests:
      - cluster_ids_exist:
          cluster_ids: HFLVSD_COD, HFRES_COD, HF_COD, REDEJCFRAC_COD
